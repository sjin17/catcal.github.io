<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çŒ«å’ªè®°è´¦æœ¬</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
    
    <!-- é…ç½®Tailwindè‡ªå®šä¹‰é¢œè‰²å’Œå­—ä½“ -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#FF9AA2', // ç²‰è‰²ä½œä¸ºä¸»è‰²è°ƒ
                        secondary: '#B5EAD7', // æµ…ç»¿è‰²ä½œä¸ºè¾…åŠ©è‰²
                        accent: '#FFDAC1', // æµ…æ©™è‰²ä½œä¸ºå¼ºè°ƒè‰²
                        dark: '#6D6875', // æ·±ç´«è‰²ä½œä¸ºæ–‡å­—è‰²
                        light: '#FFF1F2', // ææµ…ç²‰è‰²ä½œä¸ºèƒŒæ™¯è‰²
                    },
                    fontFamily: {
                        cat: ['"Comic Sans MS"', '"Marker Felt"', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .cat-shadow {
                box-shadow: 0 4px 15px rgba(255, 154, 162, 0.3);
            }
            .cat-border {
                border: 2px dashed #FF9AA2;
            }
            .rotate-cat {
                transform: rotate(-5deg);
            }
            .rotate-cat-reverse {
                transform: rotate(5deg);
            }
        }
    </style>
</head>
<body class="bg-light font-cat text-dark min-h-screen flex flex-col">
    <!-- ç™»å½•æ¨¡æ€æ¡† -->
    <div id="login-modal" class="fixed inset-0 bg-black/70 flex items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 w-full max-w-md mx-4 cat-shadow rotate-cat">
            <div class="flex justify-center mb-6">
                <div class="w-16 h-16 bg-primary/20 rounded-full flex items-center justify-center">
                    <i class="fa fa-paw text-primary text-3xl"></i>
                </div>
            </div>
            <h2 class="text-2xl font-bold text-center mb-6">çŒ«å’ªè®°è´¦æœ¬ç™»å½•</h2>
            
            <div class="mb-4">
                <button id="show-login" class="w-full py-2 mb-2 border-b-2 border-primary text-primary font-medium">ç™»å½•</button>
                <button id="show-register" class="w-full py-2 mb-2 border-b-2 border-transparent text-gray-500 hover:text-primary transition-colors">æ³¨å†Œ</button>
            </div>
            
            <!-- ç™»å½•è¡¨å• -->
            <form id="login-form" class="space-y-4">
                <div>
                    <label for="login-username" class="block text-sm font-medium text-gray-700 mb-1">ç”¨æˆ·å</label>
                    <input type="text" id="login-username" required
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all">
                </div>
                
                <div>
                    <label for="login-password" class="block text-sm font-medium text-gray-700 mb-1">å¯†ç </label>
                    <input type="password" id="login-password" required
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all">
                </div>
                
                <button type="submit" class="w-full bg-primary hover:bg-primary/90 text-white py-3 rounded-lg transition-colors flex items-center justify-center">
                    <i class="fa fa-sign-in mr-2"></i> ç™»å½•
                </button>
            </form>
            
            <!-- æ³¨å†Œè¡¨å• (é»˜è®¤éšè—) -->
            <form id="register-form" class="space-y-4 hidden">
                <div>
                    <label for="register-username" class="block text-sm font-medium text-gray-700 mb-1">ç”¨æˆ·å</label>
                    <input type="text" id="register-username" required
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all">
                </div>
                
                <div>
                    <label for="register-password" class="block text-sm font-medium text-gray-700 mb-1">å¯†ç </label>
                    <input type="password" id="register-password" required minlength="6"
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all">
                </div>
                
                <div>
                    <label for="register-confirm" class="block text-sm font-medium text-gray-700 mb-1">ç¡®è®¤å¯†ç </label>
                    <input type="password" id="register-confirm" required
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all">
                </div>
                
                <button type="submit" class="w-full bg-secondary hover:bg-secondary/90 text-dark py-3 rounded-lg transition-colors flex items-center justify-center">
                    <i class="fa fa-user-plus mr-2"></i> æ³¨å†Œ
                </button>
            </form>
        </div>
    </div>

    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <header class="bg-white shadow-md sticky top-0 z-40 transition-all duration-300">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <i class="fa fa-paw text-primary text-3xl"></i>
                <h1 class="text-2xl font-bold text-primary">çŒ«å’ªè®°è´¦æœ¬</h1>
            </div>
            
            <div class="flex items-center space-x-4">
                <span id="user-display" class="hidden md:inline-block"></span>
                <button id="logout-btn" class="text-gray-500 hover:text-primary transition-colors hidden">
                    <i class="fa fa-sign-out"></i>
                </button>
                
                <nav class="hidden md:flex space-x-6">
                    <a href="#record" class="nav-link hover:text-primary transition-colors flex items-center">
                        <i class="fa fa-plus-circle mr-1"></i> è®°è´¦
                    </a>
                    <a href="#categories" class="nav-link hover:text-primary transition-colors flex items-center">
                        <i class="fa fa-tags mr-1"></i> åˆ†ç±»
                    </a>
                    <a href="#statistics" class="nav-link hover:text-primary transition-colors flex items-center">
                        <i class="fa fa-bar-chart mr-1"></i> ç»Ÿè®¡
                    </a>
                    <a href="#history" class="nav-link hover:text-primary transition-colors flex items-center">
                        <i class="fa fa-history mr-1"></i> å†å²
                    </a>
                </nav>
                
                <button id="mobile-menu-button" class="md:hidden text-dark text-xl">
                    <i class="fa fa-bars"></i>
                </button>
            </div>
        </div>
        
        <!-- ç§»åŠ¨ç«¯èœå• -->
        <div id="mobile-menu" class="hidden md:hidden bg-white border-t border-gray-100">
            <div class="container mx-auto px-4 py-2 flex flex-col space-y-3">
                <a href="#record" class="py-2 hover:text-primary transition-colors flex items-center">
                    <i class="fa fa-plus-circle mr-2"></i> è®°è´¦
                </a>
                <a href="#categories" class="py-2 hover:text-primary transition-colors flex items-center">
                    <i class="fa fa-tags mr-2"></i> åˆ†ç±»
                </a>
                <a href="#statistics" class="py-2 hover:text-primary transition-colors flex items-center">
                    <i class="fa fa-bar-chart mr-2"></i> ç»Ÿè®¡
                </a>
                <a href="#history" class="py-2 hover:text-primary transition-colors flex items-center">
                    <i class="fa fa-history mr-2"></i> å†å²
                </a>
                <div class="py-2 border-t border-gray-100 flex items-center justify-between">
                    <span id="mobile-user-display"></span>
                    <button id="mobile-logout-btn" class="text-gray-500 hover:text-primary transition-colors">
                        <i class="fa fa-sign-out"></i> é€€å‡º
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- ä¸»è¦å†…å®¹åŒº -->
    <main class="flex-grow container mx-auto px-4 py-6">
        <!-- æ¬¢è¿æ¶ˆæ¯å’ŒçŠ¶æ€å¡ç‰‡ -->
        <section class="mb-8">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6">
                <div>
                    <h2 class="text-[clamp(1.5rem,3vw,2.5rem)] font-bold">
                        ä½ å¥½ï¼Œ<span id="welcome-username"></span>ï¼
                        <span class="text-primary">ğŸ¾</span>
                    </h2>
                    <p class="text-gray-600">ä»Šå¤©æ˜¯ <span id="current-date" class="font-semibold"></span></p>
                </div>
                
                <div class="mt-4 md:mt-0 bg-white rounded-lg p-4 cat-shadow rotate-cat">
                    <div class="flex items-center">
                        <div class="w-12 h-12 bg-primary/20 rounded-full flex items-center justify-center mr-3">
                            <i class="fa fa-money text-primary text-xl"></i>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500">æœ¬æœˆæ”¯å‡º</p>
                            <p class="text-xl font-bold" id="monthly-total">Â¥0.00</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- å¿«æ·ç»Ÿè®¡å¡ç‰‡ -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="bg-white rounded-lg p-4 cat-shadow hover:scale-105 transition-transform">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-secondary/30 rounded-full flex items-center justify-center mr-3">
                            <i class="fa fa-shopping-cart text-green-500"></i>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500">æœ€å¤§æ”¯å‡ºåˆ†ç±»</p>
                            <p class="font-bold" id="top-category">æš‚æ— æ•°æ®</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-lg p-4 cat-shadow hover:scale-105 transition-transform">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-accent/30 rounded-full flex items-center justify-center mr-3">
                            <i class="fa fa-calendar text-orange-500"></i>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500">æœ¬æœˆè®°å½•æ•°</p>
                            <p class="font-bold" id="record-count">0</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-lg p-4 cat-shadow hover:scale-105 transition-transform">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-primary/20 rounded-full flex items-center justify-center mr-3">
                            <i class="fa fa-line-chart text-pink-500"></i>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500">è¾ƒä¸Šæœˆå˜åŒ–</p>
                            <p class="font-bold" id="monthly-change">0%</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- è®°è´¦åŒºåŸŸ -->
        <section id="record" class="mb-10 bg-white rounded-xl p-6 cat-shadow">
            <div class="flex items-center mb-4">
                <div class="w-10 h-10 bg-primary/20 rounded-full flex items-center justify-center mr-3">
                    <i class="fa fa-plus-circle text-primary"></i>
                </div>
                <h2 class="text-2xl font-bold">æ·»åŠ æ–°è®°å½•</h2>
            </div>
            
            <form id="expense-form" class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="amount" class="block text-sm font-medium text-gray-700 mb-1">
                            é‡‘é¢ <span class="text-red-500">*</span>
                        </label>
                        <div class="relative">
                            <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500">Â¥</span>
                            <input type="number" id="amount" name="amount" step="0.01" min="0.01" 
                                class="w-full pl-8 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all"
                                required placeholder="0.00">
                        </div>
                    </div>
                    
                    <div>
                        <label for="category" class="block text-sm font-medium text-gray-700 mb-1">
                            åˆ†ç±» <span class="text-red-500">*</span>
                        </label>
                        <select id="category" name="category" 
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all"
                            required>
                            <option value="">è¯·é€‰æ‹©åˆ†ç±»</option>
                            <!-- åˆ†ç±»é€‰é¡¹å°†é€šè¿‡JSåŠ¨æ€æ·»åŠ  -->
                        </select>
                    </div>
                </div>
                
                <div>
                    <label for="description" class="block text-sm font-medium text-gray-700 mb-1">
                        å¤‡æ³¨
                    </label>
                    <input type="text" id="description" name="description" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all"
                        placeholder="ä¾‹å¦‚ï¼šè´­ä¹°çŒ«å’ªé›¶é£Ÿ">
                </div>
                
                <div>
                    <label for="date" class="block text-sm font-medium text-gray-700 mb-1">
                        æ—¥æœŸ <span class="text-red-500">*</span>
                    </label>
                    <input type="date" id="date" name="date" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all"
                        required>
                </div>
                
                <div class="flex justify-end">
                    <button type="submit" class="bg-primary hover:bg-primary/90 text-white px-6 py-2 rounded-lg transition-colors flex items-center">
                        <i class="fa fa-paw mr-2"></i> ä¿å­˜è®°å½•
                    </button>
                </div>
            </form>
        </section>

        <!-- åˆ†ç±»ç®¡ç† -->
        <section id="categories" class="mb-10 bg-white rounded-xl p-6 cat-shadow">
            <div class="flex items-center justify-between mb-4">
                <div class="flex items-center">
                    <div class="w-10 h-10 bg-primary/20 rounded-full flex items-center justify-center mr-3">
                        <i class="fa fa-tags text-primary"></i>
                    </div>
                    <h2 class="text-2xl font-bold">åˆ†ç±»ç®¡ç†</h2>
                </div>
                
                <button id="add-category-btn" class="bg-secondary hover:bg-secondary/90 text-dark px-4 py-2 rounded-lg transition-colors flex items-center">
                    <i class="fa fa-plus mr-2"></i> æ·»åŠ åˆ†ç±»
                </button>
            </div>
            
            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4" id="categories-container">
                <!-- åˆ†ç±»å¡ç‰‡å°†é€šè¿‡JSåŠ¨æ€æ·»åŠ  -->
            </div>
            
            <!-- æ·»åŠ åˆ†ç±»æ¨¡æ€æ¡† -->
            <div id="category-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
                <div class="bg-white rounded-xl p-6 w-full max-w-md mx-4 cat-shadow rotate-cat">
                    <h3 class="text-xl font-bold mb-4">æ·»åŠ æ–°åˆ†ç±»</h3>
                    <form id="add-category-form" class="space-y-4">
                        <div>
                            <label for="new-category-name" class="block text-sm font-medium text-gray-700 mb-1">
                                åˆ†ç±»åç§° <span class="text-red-500">*</span>
                            </label>
                            <input type="text" id="new-category-name" name="new-category-name" 
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all"
                                required placeholder="ä¾‹å¦‚ï¼šçŒ«å’ªç”¨å“">
                        </div>
                        
                        <div>
                            <label for="category-icon" class="block text-sm font-medium text-gray-700 mb-1">
                                é€‰æ‹©å›¾æ ‡
                            </label>
                            <div class="grid grid-cols-6 gap-2 mt-1" id="icon-selector">
                                <div class="icon-option w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center cursor-pointer hover:bg-primary/20 transition-colors" data-icon="fa-shopping-bag">
                                    <i class="fa fa-shopping-bag"></i>
                                </div>
                                <div class="icon-option w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center cursor-pointer hover:bg-primary/20 transition-colors" data-icon="fa-utensils">
                                    <i class="fa fa-utensils"></i>
                                </div>
                                <div class="icon-option w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center cursor-pointer hover:bg-primary/20 transition-colors" data-icon="fa-home">
                                    <i class="fa fa-home"></i>
                                </div>
                                <div class="icon-option w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center cursor-pointer hover:bg-primary/20 transition-colors" data-icon="fa-car">
                                    <i class="fa fa-car"></i>
                                </div>
                                <div class="icon-option w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center cursor-pointer hover:bg-primary/20 transition-colors" data-icon="fa-medkit">
                                    <i class="fa fa-medkit"></i>
                                </div>
                                <div class="icon-option w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center cursor-pointer hover:bg-primary/20 transition-colors" data-icon="fa-gamepad">
                                    <i class="fa fa-gamepad"></i>
                                </div>
                            </div>
                            <input type="hidden" id="selected-icon" value="fa-shopping-bag">
                        </div>
                        
                        <div class="flex justify-end space-x-3">
                            <button type="button" id="cancel-category" class="border border-gray-300 px-4 py-2 rounded-lg transition-colors">
                                å–æ¶ˆ
                            </button>
                            <button type="submit" class="bg-primary hover:bg-primary/90 text-white px-4 py-2 rounded-lg transition-colors">
                                ä¿å­˜
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </section>

        <!-- ç»Ÿè®¡åˆ†æ -->
        <section id="statistics" class="mb-10 bg-white rounded-xl p-6 cat-shadow">
            <div class="flex items-center mb-6">
                <div class="w-10 h-10 bg-primary/20 rounded-full flex items-center justify-center mr-3">
                    <i class="fa fa-bar-chart text-primary"></i>
                </div>
                <h2 class="text-2xl font-bold">ç»Ÿè®¡åˆ†æ</h2>
            </div>
            
            <!-- ç»Ÿè®¡ç­›é€‰å™¨ -->
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 space-y-3 sm:space-y-0">
                <div class="flex space-x-2">
                    <button class="period-btn bg-primary text-white px-4 py-2 rounded-lg transition-colors" data-period="month">
                        æŒ‰æœˆ
                    </button>
                    <button class="period-btn bg-gray-200 hover:bg-gray-300 px-4 py-2 rounded-lg transition-colors" data-period="year">
                        æŒ‰å¹´
                    </button>
                </div>
                
                <div class="flex flex-col sm:flex-row w-full sm:w-auto space-y-2 sm:space-y-0 sm:space-x-2">
                    <div class="relative">
                        <select id="stats-year" class="pl-3 pr-8 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all appearance-none w-full sm:w-auto">
                            <!-- å¹´ä»½é€‰é¡¹å°†é€šè¿‡JSåŠ¨æ€æ·»åŠ  -->
                        </select>
                        <i class="fa fa-chevron-down absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 pointer-events-none"></i>
                    </div>
                    
                    <div class="relative" id="month-select-container">
                        <select id="stats-month" class="pl-3 pr-8 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all appearance-none w-full sm:w-auto">
                            <option value="1">ä¸€æœˆ</option>
                            <option value="2">äºŒæœˆ</option>
                            <option value="3">ä¸‰æœˆ</option>
                            <option value="4">å››æœˆ</option>
                            <option value="5">äº”æœˆ</option>
                            <option value="6">å…­æœˆ</option>
                            <option value="7">ä¸ƒæœˆ</option>
                            <option value="8">å…«æœˆ</option>
                            <option value="9">ä¹æœˆ</option>
                            <option value="10">åæœˆ</option>
                            <option value="11">åä¸€æœˆ</option>
                            <option value="12">åäºŒæœˆ</option>
                        </select>
                        <i class="fa fa-chevron-down absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 pointer-events-none"></i>
                    </div>
                    
                    <div class="relative">
                        <select id="category-filter" class="pl-3 pr-8 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all appearance-none w-full sm:w-auto">
                            <option value="">æ‰€æœ‰åˆ†ç±»</option>
                            <!-- åˆ†ç±»ç­›é€‰é€‰é¡¹å°†é€šè¿‡JSåŠ¨æ€æ·»åŠ  -->
                        </select>
                        <i class="fa fa-chevron-down absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 pointer-events-none"></i>
                    </div>
                </div>
            </div>
            
            <!-- å›¾è¡¨åŒºåŸŸ -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h3 class="text-lg font-semibold mb-3">æ”¯å‡ºåˆ†å¸ƒ</h3>
                    <div class="aspect-square max-w-md mx-auto">
                        <canvas id="expense-chart"></canvas>
                    </div>
                </div>
                
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h3 class="text-lg font-semibold mb-3">è¶‹åŠ¿åˆ†æ</h3>
                    <div class="aspect-square max-w-md mx-auto">
                        <canvas id="trend-chart"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- åˆ†ç±»ç»Ÿè®¡è¡¨æ ¼ -->
            <div>
                <h3 class="text-lg font-semibold mb-3">åˆ†ç±»ç»Ÿè®¡è¯¦æƒ…</h3>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead>
                            <tr>
                                <th class="px-4 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">åˆ†ç±»</th>
                                <th class="px-4 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">é‡‘é¢</th>
                                <th class="px-4 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">å æ¯”</th>
                                <th class="px-4 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">è®°å½•æ•°</th>
                            </tr>
                        </thead>
                        <tbody id="category-stats-body" class="bg-white divide-y divide-gray-200">
                            <!-- ç»Ÿè®¡æ•°æ®å°†é€šè¿‡JSåŠ¨æ€æ·»åŠ  -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- å†å²è®°å½• -->
        <section id="history" class="mb-10 bg-white rounded-xl p-6 cat-shadow">
            <div class="flex items-center justify-between mb-6">
                <div class="flex items-center">
                    <div class="w-10 h-10 bg-primary/20 rounded-full flex items-center justify-center mr-3">
                        <i class="fa fa-history text-primary"></i>
                    </div>
                    <h2 class="text-2xl font-bold">å†å²è®°å½•</h2>
                </div>
                
                <div class="relative">
                    <input type="text" id="search-history" placeholder="æœç´¢å¤‡æ³¨æˆ–é‡‘é¢..."
                        class="pl-9 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all">
                    <i class="fa fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-500"></i>
                </div>
            </div>
            
            <!-- å†å²è®°å½•ç­›é€‰ -->
            <div class="flex flex-wrap gap-2 mb-4">
                <button class="history-filter-btn bg-primary text-white px-3 py-1 rounded-full text-sm transition-colors" data-filter="all">
                    å…¨éƒ¨
                </button>
                <button class="history-filter-btn bg-gray-200 hover:bg-gray-300 px-3 py-1 rounded-full text-sm transition-colors" data-filter="today">
                    ä»Šå¤©
                </button>
                <button class="history-filter-btn bg-gray-200 hover:bg-gray-300 px-3 py-1 rounded-full text-sm transition-colors" data-filter="week">
                    æœ¬å‘¨
                </button>
                <button class="history-filter-btn bg-gray-200 hover:bg-gray-300 px-3 py-1 rounded-full text-sm transition-colors" data-filter="month">
                    æœ¬æœˆ
                </button>
            </div>
            
            <!-- å†å²è®°å½•åˆ—è¡¨ -->
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead>
                        <tr>
                            <th class="px-4 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">æ—¥æœŸ</th>
                            <th class="px-4 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">åˆ†ç±»</th>
                            <th class="px-4 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">é‡‘é¢</th>
                            <th class="px-4 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">å¤‡æ³¨</th>
                            <th class="px-4 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="history-list" class="bg-white divide-y divide-gray-200">
                        <!-- å†å²è®°å½•å°†é€šè¿‡JSåŠ¨æ€æ·»åŠ  -->
                        <tr class="text-center">
                            <td colspan="5" class="px-4 py-8 text-gray-500">
                                <div class="flex flex-col items-center">
                                    <i class="fa fa-cat text-4xl text-gray-300 mb-2"></i>
                                    <p>è¿˜æ²¡æœ‰è®°å½•å“¦ï¼Œæ·»åŠ ä½ çš„ç¬¬ä¸€ç¬”æ”¯å‡ºå§ï¼</p>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- åˆ†é¡µ -->
            <div class="flex justify-center mt-6" id="pagination">
                <!-- åˆ†é¡µæŒ‰é’®å°†é€šè¿‡JSåŠ¨æ€æ·»åŠ  -->
            </div>
        </section>
    </main>

    <!-- é¡µè„š -->
    <footer class="bg-white py-6 border-t border-gray-200">
        <div class="container mx-auto px-4 text-center">
            <div class="flex justify-center items-center space-x-2 mb-2">
                <i class="fa fa-paw text-primary"></i>
                <p class="font-bold">çŒ«å’ªè®°è´¦æœ¬</p>
            </div>
            <p class="text-sm text-gray-500">ç”¨å¯çˆ±çš„æ–¹å¼ç®¡ç†ä½ çš„è´¢åŠ¡ ğŸ±</p>
        </div>
    </footer>

    <!-- ç¼–è¾‘è®°å½•æ¨¡æ€æ¡† -->
    <div id="edit-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl p-6 w-full max-w-lg mx-4 cat-shadow rotate-cat-reverse">
            <h3 class="text-xl font-bold mb-4">ç¼–è¾‘è®°å½•</h3>
            <form id="edit-form" class="space-y-4">
                <input type="hidden" id="edit-id">
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="edit-amount" class="block text-sm font-medium text-gray-700 mb-1">
                            é‡‘é¢ <span class="text-red-500">*</span>
                        </label>
                        <div class="relative">
                            <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500">Â¥</span>
                            <input type="number" id="edit-amount" name="edit-amount" step="0.01" min="0.01" 
                                class="w-full pl-8 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all"
                                required>
                        </div>
                    </div>
                    
                    <div>
                        <label for="edit-category" class="block text-sm font-medium text-gray-700 mb-1">
                            åˆ†ç±» <span class="text-red-500">*</span>
                        </label>
                        <select id="edit-category" name="edit-category" 
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all"
                            required>
                            <!-- åˆ†ç±»é€‰é¡¹å°†é€šè¿‡JSåŠ¨æ€æ·»åŠ  -->
                        </select>
                    </div>
                </div>
                
                <div>
                    <label for="edit-description" class="block text-sm font-medium text-gray-700 mb-1">
                        å¤‡æ³¨
                    </label>
                    <input type="text" id="edit-description" name="edit-description" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all">
                </div>
                
                <div>
                    <label for="edit-date" class="block text-sm font-medium text-gray-700 mb-1">
                        æ—¥æœŸ <span class="text-red-500">*</span>
                    </label>
                    <input type="date" id="edit-date" name="edit-date" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all"
                        required>
                </div>
                
                <div class="flex justify-end space-x-3">
                    <button type="button" id="cancel-edit" class="border border-gray-300 px-4 py-2 rounded-lg transition-colors">
                        å–æ¶ˆ
                    </button>
                    <button type="submit" class="bg-primary hover:bg-primary/90 text-white px-4 py-2 rounded-lg transition-colors">
                        ä¿å­˜ä¿®æ”¹
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- ç¡®è®¤åˆ é™¤æ¨¡æ€æ¡† -->
    <div id="delete-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl p-6 w-full max-w-md mx-4 cat-shadow">
            <h3 class="text-xl font-bold mb-2 flex items-center">
                <i class="fa fa-exclamation-triangle text-yellow-500 mr-2"></i> ç¡®è®¤åˆ é™¤
            </h3>
            <p class="mb-4">ä½ ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿæ­¤æ“ä½œæ— æ³•æ’¤é”€ã€‚</p>
            <input type="hidden" id="delete-id">
            <div class="flex justify-end space-x-3">
                <button id="cancel-delete" class="border border-gray-300 px-4 py-2 rounded-lg transition-colors">
                    å–æ¶ˆ
                </button>
                <button id="confirm-delete" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors">
                    åˆ é™¤
                </button>
            </div>
        </div>
    </div>

    <!-- æˆåŠŸæç¤º -->
    <div id="toast" class="fixed bottom-6 right-6 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg transform translate-y-20 opacity-0 transition-all duration-300 flex items-center">
        <i class="fa fa-check-circle mr-2"></i>
        <span id="toast-message"></span>
    </div>

    <!-- çŒ«å’ªè£…é¥°å…ƒç´  -->
    <div class="fixed top-20 left-4 opacity-20 hidden md:block rotate-cat">
        <i class="fa fa-cat text-6xl text-primary"></i>
    </div>
    <div class="fixed bottom-20 right-4 opacity-20 hidden md:block rotate-cat-reverse">
        <i class="fa fa-paw text-6xl text-primary"></i>
    </div>

    <script>
        // ç”¨æˆ·è®¤è¯æ¨¡å—
        const AuthService = {
            // åˆå§‹åŒ–ç”¨æˆ·æ•°æ®
            init() {
                if (!localStorage.getItem('users')) {
                    localStorage.setItem('users', JSON.stringify([]));
                }
            },
            
            // æ³¨å†Œæ–°ç”¨æˆ·
            register(username, password) {
                const users = JSON.parse(localStorage.getItem('users') || '[]');
                
                // æ£€æŸ¥ç”¨æˆ·åæ˜¯å¦å·²å­˜åœ¨
                if (users.some(user => user.username === username)) {
                    return { success: false, message: 'ç”¨æˆ·åå·²å­˜åœ¨' };
                }
                
                // åˆ›å»ºæ–°ç”¨æˆ·
                const newUser = {
                    id: Date.now(), // ä½¿ç”¨æ—¶é—´æˆ³ä½œä¸ºç®€å•çš„å”¯ä¸€ID
                    username,
                    password, // æ³¨æ„ï¼šå®é™…åº”ç”¨ä¸­åº”è¯¥åŠ å¯†å­˜å‚¨å¯†ç 
                    createdAt: new Date().toISOString()
                };
                
                users.push(newUser);
                localStorage.setItem('users', JSON.stringify(users));
                return { success: true, message: 'æ³¨å†ŒæˆåŠŸ' };
            },
            
            // ç”¨æˆ·ç™»å½•
            login(username, password) {
                const users = JSON.parse(localStorage.getItem('users') || '[]');
                const user = users.find(u => u.username === username && u.password === password);
                
                if (user) {
                    // ä¿å­˜ç™»å½•çŠ¶æ€
                    localStorage.setItem('currentUser', JSON.stringify({
                        id: user.id,
                        username: user.username
                    }));
                    return { success: true, message: 'ç™»å½•æˆåŠŸ' };
                }
                
                return { success: false, message: 'ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯' };
            },
            
            // ç”¨æˆ·ç™»å‡º
            logout() {
                localStorage.removeItem('currentUser');
            },
            
            // è·å–å½“å‰ç™»å½•ç”¨æˆ·
            getCurrentUser() {
                const user = localStorage.getItem('currentUser');
                return user ? JSON.parse(user) : null;
            },
            
            // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç™»å½•
            isLoggedIn() {
                return !!this.getCurrentUser();
            }
        };

        // æ•°æ®æ¨¡å‹
        const DataModel = {
            // åˆå§‹åŒ–æ•°æ®
            init() {
                AuthService.init();
                
                // æ£€æŸ¥æœ¬åœ°å­˜å‚¨ä¸­æ˜¯å¦æœ‰æ•°æ®ï¼Œæ²¡æœ‰åˆ™åˆå§‹åŒ–
                if (!localStorage.getItem('expenseCategories')) {
                    const defaultCategories = [
                        { id: 1, name: 'é¤é¥®', icon: 'fa-utensils' },
                        { id: 2, name: 'è´­ç‰©', icon: 'fa-shopping-bag' },
                        { id: 3, name: 'ä½æˆ¿', icon: 'fa-home' },
                        { id: 4, name: 'äº¤é€š', icon: 'fa-car' },
                        { id: 5, name: 'çŒ«å’ªç”¨å“', icon: 'fa-paw' }
                    ];
                    localStorage.setItem('expenseCategories', JSON.stringify(defaultCategories));
                }
                
                if (!localStorage.getItem('expenseRecords')) {
                    localStorage.setItem('expenseRecords', JSON.stringify([]));
                }
            },
            
            // è·å–æ‰€æœ‰åˆ†ç±»ï¼ˆåˆ†ç±»æ˜¯å…±äº«çš„ï¼‰
            getCategories() {
                return JSON.parse(localStorage.getItem('expenseCategories') || '[]');
            },
            
            // æ·»åŠ æ–°åˆ†ç±»
            addCategory(category) {
                const categories = this.getCategories();
                const newId = categories.length > 0 
                    ? Math.max(...categories.map(c => c.id)) + 1 
                    : 1;
                const newCategory = { id: newId, ...category };
                categories.push(newCategory);
                localStorage.setItem('expenseCategories', JSON.stringify(categories));
                return newCategory;
            },
            
            // åˆ é™¤åˆ†ç±»
            deleteCategory(id) {
                const categories = this.getCategories();
                const updatedCategories = categories.filter(c => c.id !== id);
                localStorage.setItem('expenseCategories', JSON.stringify(updatedCategories));
                
                // åŒæ—¶åˆ é™¤è¯¥åˆ†ç±»ä¸‹çš„æ‰€æœ‰è®°å½•ï¼ˆæ‰€æœ‰ç”¨æˆ·çš„ï¼‰
                const records = this.getRecords();
                const updatedRecords = records.filter(r => r.categoryId !== id);
                localStorage.setItem('expenseRecords', JSON.stringify(updatedRecords));
            },
            
            // è·å–å½“å‰ç”¨æˆ·çš„æ‰€æœ‰è®°å½•
            getRecords() {
                const currentUser = AuthService.getCurrentUser();
                if (!currentUser) return [];
                
                const allRecords = JSON.parse(localStorage.getItem('expenseRecords') || '[]');
                // åªè¿”å›å½“å‰ç”¨æˆ·çš„è®°å½•
                return allRecords.filter(record => record.userId === currentUser.id);
            },
            
            // æ·»åŠ æ–°è®°å½•ï¼ˆå…³è”åˆ°å½“å‰ç”¨æˆ·ï¼‰
            addRecord(record) {
                const currentUser = AuthService.getCurrentUser();
                if (!currentUser) return null;
                
                const allRecords = JSON.parse(localStorage.getItem('expenseRecords') || '[]');
                const newId = allRecords.length > 0 
                    ? Math.max(...allRecords.map(r => r.id)) + 1 
                    : 1;
                // æ·»åŠ ç”¨æˆ·IDï¼Œå…³è”åˆ°å½“å‰ç”¨æˆ·
                const newRecord = { id: newId, userId: currentUser.id, ...record };
                allRecords.push(newRecord);
                localStorage.setItem('expenseRecords', JSON.stringify(allRecords));
                return newRecord;
            },
            
            // æ›´æ–°è®°å½•
            updateRecord(id, updatedData) {
                const currentUser = AuthService.getCurrentUser();
                if (!currentUser) return null;
                
                const allRecords = JSON.parse(localStorage.getItem('expenseRecords') || '[]');
                const index = allRecords.findIndex(r => r.id === id && r.userId === currentUser.id);
                
                if (index !== -1) {
                    allRecords[index] = { ...allRecords[index], ...updatedData };
                    localStorage.setItem('expenseRecords', JSON.stringify(allRecords));
                    return allRecords[index];
                }
                return null;
            },
            
            // åˆ é™¤è®°å½•
            deleteRecord(id) {
                const currentUser = AuthService.getCurrentUser();
                if (!currentUser) return;
                
                const allRecords = JSON.parse(localStorage.getItem('expenseRecords') || '[]');
                const updatedRecords = allRecords.filter(r => !(r.id === id && r.userId === currentUser.id));
                localStorage.setItem('expenseRecords', JSON.stringify(updatedRecords));
            },
            
            // æŒ‰æ¡ä»¶ç­›é€‰å½“å‰ç”¨æˆ·çš„è®°å½•
            filterRecords(filters = {}) {
                const currentUser = AuthService.getCurrentUser();
                if (!currentUser) return [];
                
                let allRecords = JSON.parse(localStorage.getItem('expenseRecords') || '[]');
                // å…ˆç­›é€‰å‡ºå½“å‰ç”¨æˆ·çš„è®°å½•
                let records = allRecords.filter(r => r.userId === currentUser.id);
                
                // æŒ‰å¹´ä»½ç­›é€‰
                if (filters.year) {
                    records = records.filter(r => new Date(r.date).getFullYear() === filters.year);
                }
                
                // æŒ‰æœˆç­›é€‰
                if (filters.month) {
                    records = records.filter(r => new Date(r.date).getMonth() + 1 === filters.month);
                }
                
                // æŒ‰åˆ†ç±»ç­›é€‰
                if (filters.categoryId) {
                    records = records.filter(r => r.categoryId === filters.categoryId);
                }
                
                // æŒ‰æ—¥æœŸèŒƒå›´ç­›é€‰ï¼ˆä»Šå¤©ã€æœ¬å‘¨ã€æœ¬æœˆï¼‰
                if (filters.period) {
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);
                    
                    switch (filters.period) {
                        case 'today':
                            records = records.filter(r => new Date(r.date).toDateString() === today.toDateString());
                            break;
                        case 'week':
                            const weekStart = new Date(today);
                            weekStart.setDate(today.getDate() - today.getDay());
                            records = records.filter(r => new Date(r.date) >= weekStart && new Date(r.date) <= new Date());
                            break;
                        case 'month':
                            const monthStart = new Date(today.getFullYear(), today.getMonth(), 1);
                            records = records.filter(r => new Date(r.date) >= monthStart && new Date(r.date) <= new Date());
                            break;
                    }
                }
                
                // æŒ‰æœç´¢è¯ç­›é€‰
                if (filters.search) {
                    const searchLower = filters.search.toLowerCase();
                    records = records.filter(r => 
                        r.description.toLowerCase().includes(searchLower) || 
                        r.amount.toString().includes(searchLower)
                    );
                }
                
                // æŒ‰æ—¥æœŸé™åºæ’åº
                return records.sort((a, b) => new Date(b.date) - new Date(a.date));
            },
            
            // è·å–åˆ†ç±»ç»Ÿè®¡æ•°æ®
            getCategoryStats(filters = {}) {
                const records = this.filterRecords(filters);
                const categories = this.getCategories();
                
                // è®¡ç®—æ¯ä¸ªåˆ†ç±»çš„æ€»é‡‘é¢å’Œè®°å½•æ•°
                const stats = categories.map(category => {
                    const categoryRecords = records.filter(r => r.categoryId === category.id);
                    const total = categoryRecords.reduce((sum, r) => sum + parseFloat(r.amount), 0);
                    return {
                        category,
                        total,
                        count: categoryRecords.length
                    };
                }).filter(stat => stat.count > 0 || !filters.categoryId); // ä¿ç•™æœ‰è®°å½•çš„åˆ†ç±»æˆ–æ‰€æœ‰åˆ†ç±»ï¼ˆå½“æ²¡æœ‰ç­›é€‰ç‰¹å®šåˆ†ç±»æ—¶ï¼‰
                
                // è®¡ç®—æ€»è®¡å’Œç™¾åˆ†æ¯”
                const total = stats.reduce((sum, s) => sum + s.total, 0);
                stats.forEach(stat => {
                    stat.percentage = total > 0 ? (stat.total / total) * 100 : 0;
                });
                
                // æŒ‰é‡‘é¢é™åºæ’åº
                return {
                    stats: stats.sort((a, b) => b.total - a.total),
                    total
                };
            },
            
            // è·å–è¶‹åŠ¿ç»Ÿè®¡æ•°æ®
            getTrendStats(filters = {}) {
                const records = this.filterRecords(filters);
                const isMonthly = filters.periodType === 'month';
                
                // æŒ‰æ—¥æˆ–æŒ‰æœˆåˆ†ç»„
                const groups = {};
                
                records.forEach(record => {
                    const date = new Date(record.date);
                    let key;
                    
                    if (isMonthly) {
                        // æŒ‰æœˆè§†å›¾ï¼šæŒ‰æ—¥åˆ†ç»„
                        key = date.getDate();
                    } else {
                        // æŒ‰å¹´è§†å›¾ï¼šæŒ‰æœˆåˆ†ç»„
                        key = date.getMonth() + 1;
                    }
                    
                    if (!groups[key]) {
                        groups[key] = 0;
                    }
                    groups[key] += parseFloat(record.amount);
                });
                
                // å‡†å¤‡å›¾è¡¨æ•°æ®
                const labels = isMonthly 
                    ? Array.from({length: new Date(filters.year, filters.month, 0).getDate()}, (_, i) => i + 1)
                    : Array.from({length: 12}, (_, i) => i + 1);
                
                const data = labels.map(key => groups[key] || 0);
                
                return {
                    labels,
                    data
                };
            }
        };

        // UIæ§åˆ¶å™¨
        const UIController = {
            // åˆå§‹åŒ–UI
            init() {
                // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç™»å½•
                if (AuthService.isLoggedIn()) {
                    this.showApp();
                    this.updateUserDisplay();
                } else {
                    // æ˜¾ç¤ºç™»å½•æ¨¡æ€æ¡†
                    document.getElementById('login-modal').classList.remove('hidden');
                }
                
                this.setCurrentDate();
                this.initDateField();
                this.renderCategories();
                this.renderHistory();
                this.renderStatistics();
                this.updateSummaryStats();
                this.initEventListeners();
                this.populateYearSelector();
            },
            
            // æ˜¾ç¤ºåº”ç”¨å†…å®¹ï¼ˆç”¨æˆ·å·²ç™»å½•ï¼‰
            showApp() {
                document.getElementById('login-modal').classList.add('hidden');
                // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ åº”ç”¨å†…å®¹çš„æ˜¾ç¤ºé€»è¾‘
            },
            
            // æ›´æ–°ç”¨æˆ·æ˜¾ç¤º
            updateUserDisplay() {
                const user = AuthService.getCurrentUser();
                if (user) {
                    document.getElementById('user-display').textContent = `æ¬¢è¿ï¼Œ${user.username}`;
                    document.getElementById('mobile-user-display').textContent = user.username;
                    document.getElementById('welcome-username').textContent = user.username;
                    document.getElementById('logout-btn').classList.remove('hidden');
                }
            },
            
            // è®¾ç½®å½“å‰æ—¥æœŸæ˜¾ç¤º
            setCurrentDate() {
                const now = new Date();
                const options = { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' };
                document.getElementById('current-date').textContent = now.toLocaleDateString('zh-CN', options);
            },
            
            // åˆå§‹åŒ–æ—¥æœŸå­—æ®µä¸ºå½“å‰æ—¥æœŸ
            initDateField() {
                const now = new Date();
                const dateString = now.toISOString().split('T')[0];
                document.getElementById('date').value = dateString;
                
                // è®¾ç½®ç»Ÿè®¡é»˜è®¤å¹´ä»½å’Œæœˆä»½ä¸ºå½“å‰
                document.getElementById('stats-year').value = now.getFullYear();
                document.getElementById('stats-month').value = now.getMonth() + 1;
            },
            
            // æ¸²æŸ“åˆ†ç±»åˆ—è¡¨
            renderCategories() {
                const categories = DataModel.getCategories();
                const container = document.getElementById('categories-container');
                const categorySelect = document.getElementById('category');
                const editCategorySelect = document.getElementById('edit-category');
                const filterSelect = document.getElementById('category-filter');
                
                // æ¸…ç©ºç°æœ‰å†…å®¹
                container.innerHTML = '';
                categorySelect.innerHTML = '<option value="">è¯·é€‰æ‹©åˆ†ç±»</option>';
                editCategorySelect.innerHTML = '';
                filterSelect.innerHTML = '<option value="">æ‰€æœ‰åˆ†ç±»</option>';
                
                // æ·»åŠ åˆ†ç±»åˆ°UI
                categories.forEach(category => {
                    // åˆ†ç±»å¡ç‰‡
                    const card = document.createElement('div');
                    card.className = 'bg-gray-50 rounded-lg p-4 flex justify-between items-center cat-border hover:bg-primary/5 transition-colors';
                    card.innerHTML = `
                        <div class="flex items-center">
                            <div class="w-10 h-10 bg-primary/20 rounded-full flex items-center justify-center mr-3">
                                <i class="fa ${category.icon} text-primary"></i>
                            </div>
                            <span class="font-medium">${category.name}</span>
                        </div>
                        <button class="delete-category text-gray-400 hover:text-red-500 transition-colors" data-id="${category.id}">
                            <i class="fa fa-trash"></i>
                        </button>
                    `;
                    container.appendChild(card);
                    
                    // æ·»åŠ åˆ°åˆ†ç±»é€‰æ‹©å™¨
                    const option = document.createElement('option');
                    option.value = category.id;
                    option.textContent = category.name;
                    categorySelect.appendChild(option);
                    
                    // æ·»åŠ åˆ°ç¼–è¾‘åˆ†ç±»é€‰æ‹©å™¨
                    const editOption = document.createElement('option');
                    editOption.value = category.id;
                    editOption.textContent = category.name;
                    editCategorySelect.appendChild(editOption);
                    
                    // æ·»åŠ åˆ°ç­›é€‰å™¨
                    const filterOption = document.createElement('option');
                    filterOption.value = category.id;
                    filterOption.textContent = category.name;
                    filterSelect.appendChild(filterOption);
                });
            },
            
            // æ¸²æŸ“å†å²è®°å½•
            renderHistory(filters = {}) {
                const records = DataModel.filterRecords(filters);
                const container = document.getElementById('history-list');
                const categories = DataModel.getCategories();
                
                // æ¸…ç©ºç°æœ‰å†…å®¹
                container.innerHTML = '';
                
                if (records.length === 0) {
                    container.innerHTML = `
                        <tr class="text-center">
                            <td colspan="5" class="px-4 py-8 text-gray-500">
                                <div class="flex flex-col items-center">
                                    <i class="fa fa-cat text-4xl text-gray-300 mb-2"></i>
                                    <p>è¿˜æ²¡æœ‰è®°å½•å“¦ï¼Œæ·»åŠ ä½ çš„ç¬¬ä¸€ç¬”æ”¯å‡ºå§ï¼</p>
                                </div>
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                // æ·»åŠ è®°å½•åˆ°è¡¨æ ¼
                records.forEach(record => {
                    const category = categories.find(c => c.id === record.categoryId);
                    const row = document.createElement('tr');
                    row.className = 'hover:bg-gray-50 transition-colors';
                    row.innerHTML = `
                        <td class="px-4 py-3 whitespace-nowrap">
                            ${new Date(record.date).toLocaleDateString('zh-CN')}
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap">
                            <div class="flex items-center">
                                <i class="fa ${category?.icon || 'fa-question'} text-primary mr-2"></i>
                                ${category?.name || 'æœªçŸ¥åˆ†ç±»'}
                            </div>
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap font-medium">
                            Â¥${parseFloat(record.amount).toFixed(2)}
                        </td>
                        <td class="px-4 py-3">
                            ${record.description || '-'}
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap">
                            <div class="flex space-x-2">
                                <button class="edit-record text-blue-500 hover:text-blue-700 transition-colors" data-id="${record.id}">
                                    <i class="fa fa-edit"></i>
                                </button>
                                <button class="delete-record text-red-500 hover:text-red-700 transition-colors" data-id="${record.id}">
                                    <i class="fa fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    container.appendChild(row);
                });
                
                // ç»‘å®šç¼–è¾‘å’Œåˆ é™¤æŒ‰é’®äº‹ä»¶
                this.bindRecordActions();
            },
            
            // æ¸²æŸ“ç»Ÿè®¡å›¾è¡¨
            renderStatistics() {
                const year = parseInt(document.getElementById('stats-year').value);
                const month = parseInt(document.getElementById('stats-month').value);
                const categoryId = document.getElementById('category-filter').value 
                    ? parseInt(document.getElementById('category-filter').value) 
                    : null;
                const isMonthly = document.querySelector('.period-btn.bg-primary').dataset.period === 'month';
                
                // ç­›é€‰æ¡ä»¶
                const filters = {
                    year,
                    categoryId,
                    periodType: isMonthly ? 'month' : 'year'
                };
                
                if (isMonthly) {
                    filters.month = month;
                }
                
                // è·å–ç»Ÿè®¡æ•°æ®
                const categoryStats = DataModel.getCategoryStats(filters);
                const trendStats = DataModel.getTrendStats(filters);
                
                // æ¸²æŸ“åˆ†ç±»ç»Ÿè®¡è¡¨æ ¼
                this.renderCategoryStatsTable(categoryStats.stats);
                
                // æ¸²æŸ“æ”¯å‡ºåˆ†å¸ƒå›¾è¡¨
                this.renderExpenseChart(categoryStats.stats);
                
                // æ¸²æŸ“è¶‹åŠ¿å›¾è¡¨
                this.renderTrendChart(trendStats, isMonthly);
            },
            
            // æ¸²æŸ“åˆ†ç±»ç»Ÿè®¡è¡¨æ ¼
            renderCategoryStatsTable(stats) {
                const container = document.getElementById('category-stats-body');
                container.innerHTML = '';
                
                if (stats.length === 0) {
                    container.innerHTML = `
                        <tr class="text-center">
                            <td colspan="4" class="px-4 py-6 text-gray-500">
                                æ²¡æœ‰æ‰¾åˆ°ç»Ÿè®¡æ•°æ®
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                stats.forEach(stat => {
                    const row = document.createElement('tr');
                    row.className = 'hover:bg-gray-50 transition-colors';
                    row.innerHTML = `
                        <td class="px-4 py-3 whitespace-nowrap">
                            <div class="flex items-center">
                                <i class="fa ${stat.category.icon} text-primary mr-2"></i>
                                ${stat.category.name}
                            </div>
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap font-medium">
                            Â¥${stat.total.toFixed(2)}
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap">
                            <div class="flex items-center">
                                <div class="w-24 bg-gray-200 rounded-full h-2 mr-2">
                                    <div class="bg-primary h-2 rounded-full" style="width: ${stat.percentage}%"></div>
                                </div>
                                <span>${stat.percentage.toFixed(1)}%</span>
                            </div>
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap">
                            ${stat.count}
                        </td>
                    `;
                    container.appendChild(row);
                });
            },
            
            // æ¸²æŸ“æ”¯å‡ºåˆ†å¸ƒå›¾è¡¨
            renderExpenseChart(stats) {
                const ctx = document.getElementById('expense-chart').getContext('2d');
                
                // å‡†å¤‡å›¾è¡¨æ•°æ®
                const labels = stats.map(stat => stat.category.name);
                const data = stats.map(stat => stat.total);
                const backgroundColors = [
                    '#FF9AA2', '#B5EAD7', '#C7CEEA', '#FFDAC1', '#E2F0CB', 
                    '#FD9A9A', '#FECB65', '#A1C4FD', '#C8E6C9', '#FFB7B2'
                ];
                
                // å¦‚æœå·²æœ‰å›¾è¡¨å®ä¾‹ï¼Œå…ˆé”€æ¯
                if (window.expenseChartInstance) {
                    window.expenseChartInstance.destroy();
                }
                
                // åˆ›å»ºæ–°å›¾è¡¨
                window.expenseChartInstance = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: labels,
                        datasets: [{
                            data: data,
                            backgroundColor: backgroundColors.slice(0, labels.length),
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'right',
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const value = context.raw;
                                        const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                        const percentage = ((value / total) * 100).toFixed(1);
                                        return `${context.label}: Â¥${value.toFixed(2)} (${percentage}%)`;
                                    }
                                }
                            }
                        }
                    }
                });
            },
            
            // æ¸²æŸ“è¶‹åŠ¿å›¾è¡¨
            renderTrendChart(trendStats, isMonthly) {
                const ctx = document.getElementById('trend-chart').getContext('2d');
                
                // å‡†å¤‡å›¾è¡¨æ•°æ®
                const labels = isMonthly 
                    ? trendStats.labels.map(day => `${day}æ—¥`)
                    : trendStats.labels.map(month => `${month}æœˆ`);
                
                // å¦‚æœå·²æœ‰å›¾è¡¨å®ä¾‹ï¼Œå…ˆé”€æ¯
                if (window.trendChartInstance) {
                    window.trendChartInstance.destroy();
                }
                
                // åˆ›å»ºæ–°å›¾è¡¨
                window.trendChartInstance = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'æ”¯å‡ºé‡‘é¢',
                            data: trendStats.data,
                            backgroundColor: '#FF9AA2',
                            borderColor: '#FF9AA2',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return 'Â¥' + value;
                                    }
                                }
                            }
                        },
                        plugins: {
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `é‡‘é¢: Â¥${context.raw.toFixed(2)}`;
                                    }
                                }
                            }
                        }
                    }
                });
            },
            
            // æ›´æ–°æ‘˜è¦ç»Ÿè®¡ä¿¡æ¯
            updateSummaryStats() {
                const now = new Date();
                const currentYear = now.getFullYear();
                const currentMonth = now.getMonth() + 1;
                
                // æœ¬æœˆç»Ÿè®¡
                const monthlyStats = DataModel.getCategoryStats({
                    year: currentYear,
                    month: currentMonth
                });
                
                // ä¸Šæœˆç»Ÿè®¡ï¼ˆç”¨äºè®¡ç®—å˜åŒ–ç‡ï¼‰
                let lastMonth = currentMonth - 1;
                let lastYear = currentYear;
                if (lastMonth < 1) {
                    lastMonth = 12;
                    lastYear = currentYear - 1;
                }
                
                const lastMonthStats = DataModel.getCategoryStats({
                    year: lastYear,
                    month: lastMonth
                });
                
                // æ›´æ–°UI
                document.getElementById('monthly-total').textContent = `Â¥${monthlyStats.total.toFixed(2)}`;
                document.getElementById('record-count').textContent = DataModel.filterRecords({
                    year: currentYear,
                    month: currentMonth
                }).length;
                
                // è®¡ç®—å¹¶æ›´æ–°å˜åŒ–ç‡
                if (lastMonthStats.total > 0) {
                    const changeRate = ((monthlyStats.total - lastMonthStats.total) / lastMonthStats.total) * 100;
                    const changeText = changeRate >= 0 
                        ? `+${changeRate.toFixed(1)}%` 
                        : `${changeRate.toFixed(1)}%`;
                    const changeClass = changeRate >= 0 ? 'text-red-500' : 'text-green-500';
                    const changeIcon = changeRate >= 0 ? 'fa-arrow-up' : 'fa-arrow-down';
                    
                    document.getElementById('monthly-change').innerHTML = `
                        <span class="${changeClass}">
                            <i class="fa ${changeIcon}"></i> ${changeText}
                        </span>
                    `;
                } else {
                    document.getElementById('monthly-change').textContent = '0%';
                }
                
                // æ›´æ–°æœ€å¤§æ”¯å‡ºåˆ†ç±»
                if (monthlyStats.stats.length > 0) {
                    document.getElementById('top-category').textContent = monthlyStats.stats[0].category.name;
                } else {
                    document.getElementById('top-category').textContent = 'æš‚æ— æ•°æ®';
                }
            },
            
            // å¡«å……å¹´ä»½é€‰æ‹©å™¨
            populateYearSelector() {
                const yearSelect = document.getElementById('stats-year');
                const currentUser = AuthService.getCurrentUser();
                if (!currentUser) return;
                
                const allRecords = JSON.parse(localStorage.getItem('expenseRecords') || '[]');
                const userRecords = allRecords.filter(r => r.userId === currentUser.id);
                
                // è·å–æ‰€æœ‰è®°å½•ä¸­çš„å¹´ä»½
                const years = new Set();
                const currentYear = new Date().getFullYear();
                years.add(currentYear);
                years.add(currentYear - 1);
                
                userRecords.forEach(record => {
                    const year = new Date(record.date).getFullYear();
                    years.add(year);
                });
                
                // æ¸…ç©ºå¹¶æ·»åŠ å¹´ä»½é€‰é¡¹
                yearSelect.innerHTML = '';
                Array.from(years).sort((a, b) => b - a).forEach(year => {
                    const option = document.createElement('option');
                    option.value = year;
                    option.textContent = year;
                    yearSelect.appendChild(option);
                });
            },
            
            // æ˜¾ç¤ºæç¤ºæ¶ˆæ¯
            showToast(message) {
                const toast = document.getElementById('toast');
                const toastMessage = document.getElementById('toast-message');
                
                toastMessage.textContent = message;
                toast.classList.remove('translate-y-20', 'opacity-0');
                toast.classList.add('translate-y-0', 'opacity-100');
                
                setTimeout(() => {
                    toast.classList.remove('translate-y-0', 'opacity-100');
                    toast.classList.add('translate-y-20', 'opacity-0');
                }, 3000);
            },
            
            // ç»‘å®šè®°å½•æ“ä½œæŒ‰é’®äº‹ä»¶
            bindRecordActions() {
                // ç¼–è¾‘è®°å½•
                document.querySelectorAll('.edit-record').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const id = parseInt(e.currentTarget.dataset.id);
                        const allRecords = JSON.parse(localStorage.getItem('expenseRecords') || '[]');
                        const currentUser = AuthService.getCurrentUser();
                        const record = allRecords.find(r => r.id === id && r.userId === currentUser.id);
                        
                        if (record) {
                            document.getElementById('edit-id').value = record.id;
                            document.getElementById('edit-amount').value = record.amount;
                            document.getElementById('edit-category').value = record.categoryId;
                            document.getElementById('edit-description').value = record.description || '';
                            document.getElementById('edit-date').value = record.date;
                            
                            document.getElementById('edit-modal').classList.remove('hidden');
                        }
                    });
                });
                
                // åˆ é™¤è®°å½•
                document.querySelectorAll('.delete-record').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const id = parseInt(e.currentTarget.dataset.id);
                        document.getElementById('delete-id').value = id;
                        document.getElementById('delete-modal').classList.remove('hidden');
                    });
                });
            },
            
            // åˆå§‹åŒ–æ‰€æœ‰äº‹ä»¶ç›‘å¬å™¨
            initEventListeners() {
                // ç™»å½•è¡¨å•æäº¤
                document.getElementById('login-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    
                    const username = document.getElementById('login-username').value;
                    const password = document.getElementById('login-password').value;
                    
                    const result = AuthService.login(username, password);
                    if (result.success) {
                        this.showApp();
                        this.updateUserDisplay();
                        this.renderHistory();
                        this.renderStatistics();
                        this.updateSummaryStats();
                        this.populateYearSelector();
                        this.showToast(result.message);
                    } else {
                        alert(result.message);
                    }
                });
                
                // æ³¨å†Œè¡¨å•æäº¤
                document.getElementById('register-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    
                    const username = document.getElementById('register-username').value;
                    const password = document.getElementById('register-password').value;
                    const confirm = document.getElementById('register-confirm').value;
                    
                    if (password !== confirm) {
                        alert('ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´');
                        return;
                    }
                    
                    const result = AuthService.register(username, password);
                    if (result.success) {
                        this.showLoginForm();
                        document.getElementById('login-username').value = username;
                        document.getElementById('login-password').value = password;
                        this.showToast(result.message);
                    } else {
                        alert(result.message);
                    }
                });
                
                // åˆ‡æ¢åˆ°ç™»å½•è¡¨å•
                document.getElementById('show-login').addEventListener('click', () => {
                    this.showLoginForm();
                });
                
                // åˆ‡æ¢åˆ°æ³¨å†Œè¡¨å•
                document.getElementById('show-register').addEventListener('click', () => {
                    this.showRegisterForm();
                });
                
                // ç™»å‡ºæŒ‰é’®
                document.getElementById('logout-btn').addEventListener('click', () => {
                    AuthService.logout();
                    window.location.reload(); // é‡æ–°åŠ è½½é¡µé¢ï¼Œæ˜¾ç¤ºç™»å½•ç•Œé¢
                });
                
                // ç§»åŠ¨ç«¯ç™»å‡ºæŒ‰é’®
                document.getElementById('mobile-logout-btn').addEventListener('click', () => {
                    AuthService.logout();
                    window.location.reload(); // é‡æ–°åŠ è½½é¡µé¢ï¼Œæ˜¾ç¤ºç™»å½•ç•Œé¢
                });
                
                // ç§»åŠ¨ç«¯èœå•åˆ‡æ¢
                document.getElementById('mobile-menu-button').addEventListener('click', () => {
                    document.getElementById('mobile-menu').classList.toggle('hidden');
                });
                
                // æ·»åŠ æ–°è®°å½•è¡¨å•æäº¤
                document.getElementById('expense-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    
                    const newRecord = {
                        amount: parseFloat(document.getElementById('amount').value),
                        categoryId: parseInt(document.getElementById('category').value),
                        description: document.getElementById('description').value,
                        date: document.getElementById('date').value
                    };
                    
                    DataModel.addRecord(newRecord);
                    this.renderHistory();
                    this.renderStatistics();
                    this.updateSummaryStats();
                    this.populateYearSelector();
                    
                    // é‡ç½®è¡¨å•
                    e.target.reset();
                    document.getElementById('date').value = new Date().toISOString().split('T')[0];
                    
                    this.showToast('è®°å½•æ·»åŠ æˆåŠŸï¼');
                });
                
                // æ·»åŠ åˆ†ç±»æŒ‰é’®
                document.getElementById('add-category-btn').addEventListener('click', () => {
                    document.getElementById('category-modal').classList.remove('hidden');
                    document.getElementById('new-category-name').value = '';
                    this.resetIconSelection();
                });
                
                // å–æ¶ˆæ·»åŠ åˆ†ç±»
                document.getElementById('cancel-category').addEventListener('click', () => {
                    document.getElementById('category-modal').classList.add('hidden');
                });
                
                // å›¾æ ‡é€‰æ‹©
                document.querySelectorAll('.icon-option').forEach(option => {
                    option.addEventListener('click', (e) => {
                        this.resetIconSelection();
                        e.currentTarget.classList.add('bg-primary/20', 'ring-2', 'ring-primary');
                        document.getElementById('selected-icon').value = e.currentTarget.dataset.icon;
                    });
                });
                
                // æ·»åŠ åˆ†ç±»è¡¨å•æäº¤
                document.getElementById('add-category-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    
                    const newCategory = {
                        name: document.getElementById('new-category-name').value,
                        icon: document.getElementById('selected-icon').value
                    };
                    
                    DataModel.addCategory(newCategory);
                    this.renderCategories();
                    document.getElementById('category-modal').classList.add('hidden');
                    this.showToast('åˆ†ç±»æ·»åŠ æˆåŠŸï¼');
                });
                
                // åˆ é™¤åˆ†ç±»
                document.getElementById('categories-container').addEventListener('click', (e) => {
                    if (e.target.closest('.delete-category')) {
                        const id = parseInt(e.target.closest('.delete-category').dataset.id);
                        if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªåˆ†ç±»å—ï¼Ÿè¯¥åˆ†ç±»ä¸‹çš„æ‰€æœ‰è®°å½•ä¹Ÿä¼šè¢«åˆ é™¤ã€‚')) {
                            DataModel.deleteCategory(id);
                            this.renderCategories();
                            this.renderHistory();
                            this.renderStatistics();
                            this.updateSummaryStats();
                            this.showToast('åˆ†ç±»å·²åˆ é™¤');
                        }
                    }
                });
                
                // ç»Ÿè®¡å‘¨æœŸåˆ‡æ¢
                document.querySelectorAll('.period-btn').forEach(button => {
                    button.addEventListener('click', (e) => {
                        document.querySelectorAll('.period-btn').forEach(btn => {
                            btn.classList.remove('bg-primary', 'text-white');
                            btn.classList.add('bg-gray-200', 'hover:bg-gray-300');
                        });
                        
                        e.currentTarget.classList.remove('bg-gray-200', 'hover:bg-gray-300');
                        e.currentTarget.classList.add('bg-primary', 'text-white');
                        
                        // æ˜¾ç¤ºæˆ–éšè—æœˆä»½é€‰æ‹©å™¨
                        const isMonthly = e.currentTarget.dataset.period === 'month';
                        document.getElementById('month-select-container').classList.toggle('hidden', !isMonthly);
                        
                        this.renderStatistics();
                    });
                });
                
                // ç»Ÿè®¡ç­›é€‰å™¨å˜åŒ–
                document.getElementById('stats-year').addEventListener('change', () => {
                    this.renderStatistics();
                });
                
                document.getElementById('stats-month').addEventListener('change', () => {
                    this.renderStatistics();
                });
                
                document.getElementById('category-filter').addEventListener('change', () => {
                    this.renderStatistics();
                });
                
                // å†å²è®°å½•ç­›é€‰
                document.querySelectorAll('.history-filter-btn').forEach(button => {
                    button.addEventListener('click', (e) => {
                        document.querySelectorAll('.history-filter-btn').forEach(btn => {
                            btn.classList.remove('bg-primary', 'text-white');
                            btn.classList.add('bg-gray-200', 'hover:bg-gray-300');
                        });
                        
                        e.currentTarget.classList.remove('bg-gray-200', 'hover:bg-gray-300');
                        e.currentTarget.classList.add('bg-primary', 'text-white');
                        
                        const filter = e.currentTarget.dataset.filter;
                        this.renderHistory(filter !== 'all' ? { period: filter } : {});
                    });
                });
                
                // å†å²è®°å½•æœç´¢
                document.getElementById('search-history').addEventListener('input', (e) => {
                    const searchTerm = e.target.value.trim();
                    this.renderHistory(searchTerm ? { search: searchTerm } : {});
                });
                
                // å–æ¶ˆç¼–è¾‘
                document.getElementById('cancel-edit').addEventListener('click', () => {
                    document.getElementById('edit-modal').classList.add('hidden');
                });
                
                // æäº¤ç¼–è¾‘
                document.getElementById('edit-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    
                    const id = parseInt(document.getElementById('edit-id').value);
                    const updatedData = {
                        amount: parseFloat(document.getElementById('edit-amount').value),
                        categoryId: parseInt(document.getElementById('edit-category').value),
                        description: document.getElementById('edit-description').value,
                        date: document.getElementById('edit-date').value
                    };
                    
                    DataModel.updateRecord(id, updatedData);
                    this.renderHistory();
                    this.renderStatistics();
                    this.updateSummaryStats();
                    this.populateYearSelector();
                    
                    document.getElementById('edit-modal').classList.add('hidden');
                    this.showToast('è®°å½•å·²æ›´æ–°');
                });
                
                // å–æ¶ˆåˆ é™¤
                document.getElementById('cancel-delete').addEventListener('click', () => {
                    document.getElementById('delete-modal').classList.add('hidden');
                });
                
                // ç¡®è®¤åˆ é™¤
                document.getElementById('confirm-delete').addEventListener('click', () => {
                    const id = parseInt(document.getElementById('delete-id').value);
                    DataModel.deleteRecord(id);
                    
                    this.renderHistory();
                    this.renderStatistics();
                    this.updateSummaryStats();
                    this.populateYearSelector();
                    
                    document.getElementById('delete-modal').classList.add('hidden');
                    this.showToast('è®°å½•å·²åˆ é™¤');
                });
                
                // å¹³æ»‘æ»šåŠ¨
                document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                    anchor.addEventListener('click', function(e) {
                        e.preventDefault();
                        const targetId = this.getAttribute('href');
                        const targetElement = document.querySelector(targetId);
                        
                        if (targetElement) {
                            window.scrollTo({
                                top: targetElement.offsetTop - 80,
                                behavior: 'smooth'
                            });
                            
                            // å…³é—­ç§»åŠ¨èœå•
                            document.getElementById('mobile-menu').classList.add('hidden');
                        }
                    });
                });
                
                // æ»šåŠ¨æ—¶æ”¹å˜å¯¼èˆªæ æ ·å¼
                window.addEventListener('scroll', () => {
                    const header = document.querySelector('header');
                    if (window.scrollY > 10) {
                        header.classList.add('py-2');
                        header.classList.remove('py-3');
                    } else {
                        header.classList.add('py-3');
                        header.classList.remove('py-2');
                    }
                });
            },
            
            // æ˜¾ç¤ºç™»å½•è¡¨å•
            showLoginForm() {
                document.getElementById('login-form').classList.remove('hidden');
                document.getElementById('register-form').classList.add('hidden');
                document.getElementById('show-login').classList.add('border-primary', 'text-primary');
                document.getElementById('show-login').classList.remove('border-transparent', 'text-gray-500');
                document.getElementById('show-register').classList.add('border-transparent', 'text-gray-500');
                document.getElementById('show-register').classList.remove('border-primary', 'text-primary');
            },
            
            // æ˜¾ç¤ºæ³¨å†Œè¡¨å•
            showRegisterForm() {
                document.getElementById('login-form').classList.add('hidden');
                document.getElementById('register-form').classList.remove('hidden');
                document.getElementById('show-register').classList.add('border-primary', 'text-primary');
                document.getElementById('show-register').classList.remove('border-transparent', 'text-gray-500');
                document.getElementById('show-login').classList.add('border-transparent', 'text-gray-500');
                document.getElementById('show-login').classList.remove('border-primary', 'text-primary');
            },
            
            // é‡ç½®å›¾æ ‡é€‰æ‹©çŠ¶æ€
            resetIconSelection() {
                document.querySelectorAll('.icon-option').forEach(option => {
                    option.classList.remove('bg-primary/20', 'ring-2', 'ring-primary');
                });
                // é»˜è®¤é€‰ä¸­ç¬¬ä¸€ä¸ªå›¾æ ‡
                const firstIcon = document.querySelector('.icon-option');
                if (firstIcon) {
                    firstIcon.classList.add('bg-primary/20', 'ring-2', 'ring-primary');
                    document.getElementById('selected-icon').value = firstIcon.dataset.icon;
                }
            }
        };

        // åˆå§‹åŒ–åº”ç”¨
        document.addEventListener('DOMContentLoaded', () => {
            DataModel.init();
            UIController.init();
        });
    </script>
</body>
</html>
