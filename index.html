<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Áå´Âí™ËÆ∞Ë¥¶Êú¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
    
    <!-- ÈÖçÁΩÆTailwindËá™ÂÆö‰πâÈ¢úËâ≤ÂíåÂ≠ó‰Ωì -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#FF9AA2', // Á≤âËâ≤‰Ωú‰∏∫‰∏ªËâ≤Ë∞É
                        secondary: '#B5EAD7', // ÊµÖÁªøËâ≤‰Ωú‰∏∫ËæÖÂä©Ëâ≤
                        accent: '#FFDAC1', // ÊµÖÊ©ôËâ≤‰Ωú‰∏∫Âº∫Ë∞ÉËâ≤
                        dark: '#6D6875', // Ê∑±Á¥´Ëâ≤‰Ωú‰∏∫ÊñáÂ≠óËâ≤
                        light: '#FFF1F2', // ÊûÅÊµÖÁ≤âËâ≤‰Ωú‰∏∫ËÉåÊôØËâ≤
                    },
                    fontFamily: {
                        cat: ['"Comic Sans MS"', '"Marker Felt"', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .cat-shadow {
                box-shadow: 0 4px 15px rgba(255, 154, 162, 0.3);
            }
            .cat-border {
                border: 2px dashed #FF9AA2;
            }
            .rotate-cat {
                transform: rotate(-5deg);
            }
            .rotate-cat-reverse {
                transform: rotate(5deg);
            }
            .error-message {
                color: #dc2626;
                font-size: 0.875rem;
                margin-top: 0.25rem;
            }
        }
    </style>
</head>
<body class="bg-light font-cat text-dark min-h-screen flex flex-col">
    <!-- ÁôªÂΩïÊ®°ÊÄÅÊ°Ü -->
    <div id="login-modal" class="fixed inset-0 bg-black/70 flex items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 w-full max-w-md mx-4 cat-shadow rotate-cat">
            <div class="flex justify-center mb-6">
                <div class="w-16 h-16 bg-primary/20 rounded-full flex items-center justify-center">
                    <i class="fa fa-paw text-primary text-3xl"></i>
                </div>
            </div>
            <h2 class="text-2xl font-bold text-center mb-6">Áå´Âí™ËÆ∞Ë¥¶Êú¨ÁôªÂΩï</h2>
            
            <div class="mb-4">
                <button id="show-login" class="w-full py-2 mb-2 border-b-2 border-primary text-primary font-medium">ÁôªÂΩï</button>
                <button id="show-register" class="w-full py-2 mb-2 border-b-2 border-transparent text-gray-500 hover:text-primary transition-colors">Ê≥®ÂÜå</button>
            </div>
            
            <!-- ÁôªÂΩïË°®Âçï -->
            <form id="login-form" class="space-y-4">
                <div>
                    <label for="login-username" class="block text-sm font-medium text-gray-700 mb-1">Áî®Êà∑Âêç</label>
                    <input type="text" id="login-username" required
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all">
                </div>
                
                <div>
                    <label for="login-password" class="block text-sm font-medium text-gray-700 mb-1">ÂØÜÁ†Å</label>
                    <input type="password" id="login-password" required
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all">
                </div>
                
                <button type="submit" class="w-full bg-primary hover:bg-primary/90 text-white py-3 rounded-lg transition-colors flex items-center justify-center">
                    <i class="fa fa-sign-in mr-2"></i> ÁôªÂΩï
                </button>
            </form>
            
            <!-- Ê≥®ÂÜåË°®Âçï (ÈªòËÆ§ÈöêËóè) -->
            <form id="register-form" class="space-y-4 hidden">
                <div>
                    <label for="register-username" class="block text-sm font-medium text-gray-700 mb-1">
                        Áî®Êà∑Âêç <span class="text-red-500">*</span>
                    </label>
                    <input type="text" id="register-username" required
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all">
                    <div id="username-error" class="error-message hidden">ËØ•Áî®Êà∑ÂêçÂ∑≤Ë¢´Ê≥®ÂÜå</div>
                </div>
                
                <div>
                    <label for="register-password" class="block text-sm font-medium text-gray-700 mb-1">
                        ÂØÜÁ†Å <span class="text-red-500">*</span>
                    </label>
                    <input type="password" id="register-password" required minlength="6"
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all">
                </div>
                
                <div>
                    <label for="register-confirm" class="block text-sm font-medium text-gray-700 mb-1">
                        Á°ÆËÆ§ÂØÜÁ†Å <span class="text-red-500">*</span>
                    </label>
                    <input type="password" id="register-confirm" required
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all">
                </div>
                
                <button type="submit" class="w-full bg-secondary hover:bg-secondary/90 text-dark py-3 rounded-lg transition-colors flex items-center justify-center">
                    <i class="fa fa-user-plus mr-2"></i> Ê≥®ÂÜå
                </button>
            </form>
        </div>
    </div>

    <!-- È°∂ÈÉ®ÂØºËà™Ê†è -->
    <header class="bg-white shadow-md sticky top-0 z-40 transition-all duration-300">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <i class="fa fa-paw text-primary text-3xl"></i>
                <h1 class="text-2xl font-bold text-primary">Áå´Âí™ËÆ∞Ë¥¶Êú¨</h1>
            </div>
            
            <div class="flex items-center space-x-4">
                <span id="user-display" class="hidden md:inline-block"></span>
                <button id="logout-btn" class="text-gray-500 hover:text-primary transition-colors hidden">
                    <i class="fa fa-sign-out"></i>
                </button>
                
                <nav class="hidden md:flex space-x-6">
                    <a href="#record" class="nav-link hover:text-primary transition-colors flex items-center">
                        <i class="fa fa-plus-circle mr-1"></i> ËÆ∞Ë¥¶
                    </a>
                    <a href="#categories" class="nav-link hover:text-primary transition-colors flex items-center">
                        <i class="fa fa-tags mr-1"></i> ÂàÜÁ±ª
                    </a>
                    <a href="#statistics" class="nav-link hover:text-primary transition-colors flex items-center">
                        <i class="fa fa-bar-chart mr-1"></i> ÁªüËÆ°
                    </a>
                    <a href="#history" class="nav-link hover:text-primary transition-colors flex items-center">
                        <i class="fa fa-history mr-1"></i> ÂéÜÂè≤
                    </a>
                </nav>
                
                <button id="mobile-menu-button" class="md:hidden text-dark text-xl">
                    <i class="fa fa-bars"></i>
                </button>
            </div>
        </div>
        
        <!-- ÁßªÂä®Á´ØËèúÂçï -->
        <div id="mobile-menu" class="hidden md:hidden bg-white border-t border-gray-100">
            <div class="container mx-auto px-4 py-2 flex flex-col space-y-3">
                <a href="#record" class="py-2 hover:text-primary transition-colors flex items-center">
                    <i class="fa fa-plus-circle mr-2"></i> ËÆ∞Ë¥¶
                </a>
                <a href="#categories" class="py-2 hover:text-primary transition-colors flex items-center">
                    <i class="fa fa-tags mr-2"></i> ÂàÜÁ±ª
                </a>
                <a href="#statistics" class="py-2 hover:text-primary transition-colors flex items-center">
                    <i class="fa fa-bar-chart mr-2"></i> ÁªüËÆ°
                </a>
                <a href="#history" class="py-2 hover:text-primary transition-colors flex items-center">
                    <i class="fa fa-history mr-2"></i> ÂéÜÂè≤
                </a>
                <div class="py-2 border-t border-gray-100 flex items-center justify-between">
                    <span id="mobile-user-display"></span>
                    <button id="mobile-logout-btn" class="text-gray-500 hover:text-primary transition-colors">
                        <i class="fa fa-sign-out"></i> ÈÄÄÂá∫
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- ‰∏ªË¶ÅÂÜÖÂÆπÂå∫ -->
    <main class="flex-grow container mx-auto px-4 py-6">
        <!-- Ê¨¢ËøéÊ∂àÊÅØÂíåÁä∂ÊÄÅÂç°Áâá -->
        <section class="mb-8">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6">
                <div>
                    <h2 class="text-[clamp(1.5rem,3vw,2.5rem)] font-bold">
                        ‰Ω†Â•ΩÔºå<span id="welcome-username"></span>ÔºÅ
                        <span class="text-primary">üêæ</span>
                    </h2>
                    <p class="text-gray-600">‰ªäÂ§©ÊòØ <span id="current-date" class="font-semibold"></span></p>
                </div>
                
                <div class="mt-4 md:mt-0 bg-white rounded-lg p-4 cat-shadow rotate-cat">
                    <div class="flex items-center">
                        <div class="w-12 h-12 bg-primary/20 rounded-full flex items-center justify-center mr-3">
                            <i class="fa fa-money text-primary text-xl"></i>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500">Êú¨ÊúàÊîØÂá∫</p>
                            <p class="text-xl font-bold" id="monthly-total">¬•0.00</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Âø´Êç∑ÁªüËÆ°Âç°Áâá -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="bg-white rounded-lg p-4 cat-shadow hover:scale-105 transition-transform">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-secondary/30 rounded-full flex items-center justify-center mr-3">
                            <i class="fa fa-shopping-cart text-green-500"></i>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500">ÊúÄÂ§ßÊîØÂá∫ÂàÜÁ±ª</p>
                            <p class="font-bold" id="top-category">ÊöÇÊó†Êï∞ÊçÆ</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-lg p-4 cat-shadow hover:scale-105 transition-transform">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-accent/30 rounded-full flex items-center justify-center mr-3">
                            <i class="fa fa-calendar text-orange-500"></i>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500">Êú¨ÊúàËÆ∞ÂΩïÊï∞</p>
                            <p class="font-bold" id="record-count">0</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-lg p-4 cat-shadow hover:scale-105 transition-transform">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-primary/20 rounded-full flex items-center justify-center mr-3">
                            <i class="fa fa-line-chart text-pink-500"></i>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500">ËæÉ‰∏äÊúàÂèòÂåñ</p>
                            <p class="font-bold" id="monthly-change">0%</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ËÆ∞Ë¥¶Âå∫Âüü -->
        <section id="record" class="mb-10 bg-white rounded-xl p-6 cat-shadow">
            <div class="flex items-center mb-4">
                <div class="w-10 h-10 bg-primary/20 rounded-full flex items-center justify-center mr-3">
                    <i class="fa fa-plus-circle text-primary"></i>
                </div>
                <h2 class="text-2xl font-bold">Ê∑ªÂä†Êñ∞ËÆ∞ÂΩï</h2>
            </div>
            
            <form id="expense-form" class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="amount" class="block text-sm font-medium text-gray-700 mb-1">
                            ÈáëÈ¢ù <span class="text-red-500">*</span>
                        </label>
                        <div class="relative">
                            <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500">¬•</span>
                            <input type="number" id="amount" name="amount" step="0.01" min="0.01" 
                                class="w-full pl-8 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all"
                                required placeholder="0.00">
                        </div>
                    </div>
                    
                    <div>
                        <label for="category" class="block text-sm font-medium text-gray-700 mb-1">
                            ÂàÜÁ±ª <span class="text-red-500">*</span>
                        </label>
                        <select id="category" name="category" 
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all"
                            required>
                            <option value="">ËØ∑ÈÄâÊã©ÂàÜÁ±ª</option>
                            <!-- ÂàÜÁ±ªÈÄâÈ°πÂ∞ÜÈÄöËøáJSÂä®ÊÄÅÊ∑ªÂä† -->
                        </select>
                    </div>
                </div>
                
                <div>
                    <label for="description" class="block text-sm font-medium text-gray-700 mb-1">
                        Â§áÊ≥®
                    </label>
                    <input type="text" id="description" name="description" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all"
                        placeholder="‰æãÂ¶ÇÔºöË¥≠‰π∞Áå´Âí™Èõ∂È£ü">
                </div>
                
                <div>
                    <label for="date" class="block text-sm font-medium text-gray-700 mb-1">
                        Êó•Êúü <span class="text-red-500">*</span>
                    </label>
                    <input type="date" id="date" name="date" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all"
                        required>
                </div>
                
                <div class="flex justify-end">
                    <button type="submit" class="bg-primary hover:bg-primary/90 text-white px-6 py-2 rounded-lg transition-colors flex items-center">
                        <i class="fa fa-paw mr-2"></i> ‰øùÂ≠òËÆ∞ÂΩï
                    </button>
                </div>
            </form>
        </section>

        <!-- ÂàÜÁ±ªÁÆ°ÁêÜ -->
        <section id="categories" class="mb-10 bg-white rounded-xl p-6 cat-shadow">
            <div class="flex items-center justify-between mb-4">
                <div class="flex items-center">
                    <div class="w-10 h-10 bg-primary/20 rounded-full flex items-center justify-center mr-3">
                        <i class="fa fa-tags text-primary"></i>
                    </div>
                    <h2 class="text-2xl font-bold">ÂàÜÁ±ªÁÆ°ÁêÜ</h2>
                </div>
                
                <button id="add-category-btn" class="bg-secondary hover:bg-secondary/90 text-dark px-4 py-2 rounded-lg transition-colors flex items-center">
                    <i class="fa fa-plus mr-2"></i> Ê∑ªÂä†ÂàÜÁ±ª
                </button>
            </div>
            
            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4" id="categories-container">
                <!-- ÂàÜÁ±ªÂç°ÁâáÂ∞ÜÈÄöËøáJSÂä®ÊÄÅÊ∑ªÂä† -->
            </div>
            
            <!-- Ê∑ªÂä†ÂàÜÁ±ªÊ®°ÊÄÅÊ°Ü -->
            <div id="category-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
                <div class="bg-white rounded-xl p-6 w-full max-w-md mx-4 cat-shadow rotate-cat">
                    <h3 class="text-xl font-bold mb-4">Ê∑ªÂä†Êñ∞ÂàÜÁ±ª</h3>
                    <form id="add-category-form" class="space-y-4">
                        <div>
                            <label for="new-category-name" class="block text-sm font-medium text-gray-700 mb-1">
                                ÂàÜÁ±ªÂêçÁß∞ <span class="text-red-500">*</span>
                            </label>
                            <input type="text" id="new-category-name" name="new-category-name" 
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all"
                                required placeholder="‰æãÂ¶ÇÔºöÁå´Âí™Áî®ÂìÅ">
                        </div>
                        
                        <div>
                            <label for="category-icon" class="block text-sm font-medium text-gray-700 mb-1">
                                ÈÄâÊã©ÂõæÊ†á
                            </label>
                            <div class="grid grid-cols-6 gap-2 mt-1" id="icon-selector">
                                <div class="icon-option w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center cursor-pointer hover:bg-primary/20 transition-colors" data-icon="fa-shopping-bag">
                                    <i class="fa fa-shopping-bag"></i>
                                </div>
                                <div class="icon-option w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center cursor-pointer hover:bg-primary/20 transition-colors" data-icon="fa-utensils">
                                    <i class="fa fa-utensils"></i>
                                </div>
                                <div class="icon-option w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center cursor-pointer hover:bg-primary/20 transition-colors" data-icon="fa-home">
                                    <i class="fa fa-home"></i>
                                </div>
                                <div class="icon-option w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center cursor-pointer hover:bg-primary/20 transition-colors" data-icon="fa-car">
                                    <i class="fa fa-car"></i>
                                </div>
                                <div class="icon-option w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center cursor-pointer hover:bg-primary/20 transition-colors" data-icon="fa-medkit">
                                    <i class="fa fa-medkit"></i>
                                </div>
                                <div class="icon-option w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center cursor-pointer hover:bg-primary/20 transition-colors" data-icon="fa-gamepad">
                                    <i class="fa fa-gamepad"></i>
                                </div>
                            </div>
                            <input type="hidden" id="selected-icon" value="fa-shopping-bag">
                        </div>
                        
                        <div class="flex justify-end space-x-3">
                            <button type="button" id="cancel-category" class="border border-gray-300 px-4 py-2 rounded-lg transition-colors">
                                ÂèñÊ∂à
                            </button>
                            <button type="submit" class="bg-primary hover:bg-primary/90 text-white px-4 py-2 rounded-lg transition-colors">
                                ‰øùÂ≠ò
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </section>

        <!-- ÁªüËÆ°ÂàÜÊûê -->
        <section id="statistics" class="mb-10 bg-white rounded-xl p-6 cat-shadow">
            <div class="flex items-center mb-6">
                <div class="w-10 h-10 bg-primary/20 rounded-full flex items-center justify-center mr-3">
                    <i class="fa fa-bar-chart text-primary"></i>
                </div>
                <h2 class="text-2xl font-bold">ÁªüËÆ°ÂàÜÊûê</h2>
            </div>
            
            <!-- ÁªüËÆ°Á≠õÈÄâÂô® -->
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 space-y-3 sm:space-y-0">
                <div class="flex space-x-2">
                    <button class="period-btn bg-primary text-white px-4 py-2 rounded-lg transition-colors" data-period="month">
                        ÊåâÊúà
                    </button>
                    <button class="period-btn bg-gray-200 hover:bg-gray-300 px-4 py-2 rounded-lg transition-colors" data-period="year">
                        ÊåâÂπ¥
                    </button>
                </div>
                
                <div class="flex flex-col sm:flex-row w-full sm:w-auto space-y-2 sm:space-y-0 sm:space-x-2">
                    <div class="relative">
                        <select id="stats-year" class="pl-3 pr-8 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all appearance-none w-full sm:w-auto">
                            <!-- Âπ¥‰ªΩÈÄâÈ°πÂ∞ÜÈÄöËøáJSÂä®ÊÄÅÊ∑ªÂä† -->
                        </select>
                        <i class="fa fa-chevron-down absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 pointer-events-none"></i>
                    </div>
                    
                    <div class="relative" id="month-select-container">
                        <select id="stats-month" class="pl-3 pr-8 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all appearance-none w-full sm:w-auto">
                            <option value="1">‰∏ÄÊúà</option>
                            <option value="2">‰∫åÊúà</option>
                            <option value="3">‰∏âÊúà</option>
                            <option value="4">ÂõõÊúà</option>
                            <option value="5">‰∫îÊúà</option>
                            <option value="6">ÂÖ≠Êúà</option>
                            <option value="7">‰∏ÉÊúà</option>
                            <option value="8">ÂÖ´Êúà</option>
                            <option value="9">‰πùÊúà</option>
                            <option value="10">ÂçÅÊúà</option>
                            <option value="11">ÂçÅ‰∏ÄÊúà</option>
                            <option value="12">ÂçÅ‰∫åÊúà</option>
                        </select>
                        <i class="fa fa-chevron-down absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 pointer-events-none"></i>
                    </div>
                    
                    <div class="relative">
                        <select id="category-filter" class="pl-3 pr-8 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all appearance-none w-full sm:w-auto">
                            <option value="">ÊâÄÊúâÂàÜÁ±ª</option>
                            <!-- ÂàÜÁ±ªÁ≠õÈÄâÈÄâÈ°πÂ∞ÜÈÄöËøáJSÂä®ÊÄÅÊ∑ªÂä† -->
                        </select>
                        <i class="fa fa-chevron-down absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 pointer-events-none"></i>
                    </div>
                </div>
            </div>
            
            <!-- ÂõæË°®Âå∫Âüü -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h3 class="text-lg font-semibold mb-3">ÊîØÂá∫ÂàÜÂ∏É</h3>
                    <div class="aspect-square max-w-md mx-auto">
                        <canvas id="expense-chart"></canvas>
                    </div>
                </div>
                
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h3 class="text-lg font-semibold mb-3">Ë∂ãÂäøÂàÜÊûê</h3>
                    <div class="aspect-square max-w-md mx-auto">
                        <canvas id="trend-chart"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- ÂàÜÁ±ªÁªüËÆ°Ë°®Ê†º -->
            <div>
                <h3 class="text-lg font-semibold mb-3">ÂàÜÁ±ªÁªüËÆ°ËØ¶ÊÉÖ</h3>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead>
                            <tr>
                                <th class="px-4 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ÂàÜÁ±ª</th>
                                <th class="px-4 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ÈáëÈ¢ù</th>
                                <th class="px-4 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Âç†ÊØî</th>
                                <th class="px-4 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ËÆ∞ÂΩïÊï∞</th>
                            </tr>
                        </thead>
                        <tbody id="category-stats-body" class="bg-white divide-y divide-gray-200">
                            <!-- ÁªüËÆ°Êï∞ÊçÆÂ∞ÜÈÄöËøáJSÂä®ÊÄÅÊ∑ªÂä† -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- ÂéÜÂè≤ËÆ∞ÂΩï -->
        <section id="history" class="mb-10 bg-white rounded-xl p-6 cat-shadow">
            <div class="flex items-center justify-between mb-6">
                <div class="flex items-center">
                    <div class="w-10 h-10 bg-primary/20 rounded-full flex items-center justify-center mr-3">
                        <i class="fa fa-history text-primary"></i>
                    </div>
                    <h2 class="text-2xl font-bold">ÂéÜÂè≤ËÆ∞ÂΩï</h2>
                </div>
                
                <div class="relative">
                    <input type="text" id="search-history" placeholder="ÊêúÁ¥¢Â§áÊ≥®ÊàñÈáëÈ¢ù..."
                        class="pl-9 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all">
                    <i class="fa fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-500"></i>
                </div>
            </div>
            
            <!-- ÂéÜÂè≤ËÆ∞ÂΩïÁ≠õÈÄâ -->
            <div class="flex flex-wrap gap-2 mb-4">
                <button class="history-filter-btn bg-primary text-white px-3 py-1 rounded-full text-sm transition-colors" data-filter="all">
                    ÂÖ®ÈÉ®
                </button>
                <button class="history-filter-btn bg-gray-200 hover:bg-gray-300 px-3 py-1 rounded-full text-sm transition-colors" data-filter="today">
                    ‰ªäÂ§©
                </button>
                <button class="history-filter-btn bg-gray-200 hover:bg-gray-300 px-3 py-1 rounded-full text-sm transition-colors" data-filter="week">
                    Êú¨Âë®
                </button>
                <button class="history-filter-btn bg-gray-200 hover:bg-gray-300 px-3 py-1 rounded-full text-sm transition-colors" data-filter="month">
                    Êú¨Êúà
                </button>
            </div>
            
            <!-- ÂéÜÂè≤ËÆ∞ÂΩïÂàóË°® -->
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead>
                        <tr>
                            <th class="px-4 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Êó•Êúü</th>
                            <th class="px-4 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ÂàÜÁ±ª</th>
                            <th class="px-4 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ÈáëÈ¢ù</th>
                            <th class="px-4 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Â§áÊ≥®</th>
                            <th class="px-4 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Êìç‰Ωú</th>
                        </tr>
                    </thead>
                    <tbody id="history-list" class="bg-white divide-y divide-gray-200">
                        <!-- ÂéÜÂè≤ËÆ∞ÂΩïÂ∞ÜÈÄöËøáJSÂä®ÊÄÅÊ∑ªÂä† -->
                        <tr class="text-center">
                            <td colspan="5" class="px-4 py-8 text-gray-500">
                                <div class="flex flex-col items-center">
                                    <i class="fa fa-cat text-4xl text-gray-300 mb-2"></i>
                                    <p>ËøòÊ≤°ÊúâËÆ∞ÂΩïÂì¶ÔºåÊ∑ªÂä†‰Ω†ÁöÑÁ¨¨‰∏ÄÁ¨îÊîØÂá∫ÂêßÔºÅ</p>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- ÂàÜÈ°µ -->
            <div class="flex justify-center mt-6" id="pagination">
                <!-- ÂàÜÈ°µÊåâÈíÆÂ∞ÜÈÄöËøáJSÂä®ÊÄÅÊ∑ªÂä† -->
            </div>
        </section>
    </main>

    <!-- È°µËÑö -->
    <footer class="bg-white py-6 border-t border-gray-200">
        <div class="container mx-auto px-4 text-center">
            <div class="flex justify-center items-center space-x-2 mb-2">
                <i class="fa fa-paw text-primary"></i>
                <p class="font-bold">Áå´Âí™ËÆ∞Ë¥¶Êú¨</p>
            </div>
            <p class="text-sm text-gray-500">Áî®ÂèØÁà±ÁöÑÊñπÂºèÁÆ°ÁêÜ‰Ω†ÁöÑË¥¢Âä° üê±</p>
        </div>
    </footer>

    <!-- ÁºñËæëËÆ∞ÂΩïÊ®°ÊÄÅÊ°Ü -->
    <div id="edit-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl p-6 w-full max-w-lg mx-4 cat-shadow rotate-cat-reverse">
            <h3 class="text-xl font-bold mb-4">ÁºñËæëËÆ∞ÂΩï</h3>
            <form id="edit-form" class="space-y-4">
                <input type="hidden" id="edit-id">
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="edit-amount" class="block text-sm font-medium text-gray-700 mb-1">
                            ÈáëÈ¢ù <span class="text-red-500">*</span>
                        </label>
                        <div class="relative">
                            <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500">¬•</span>
                            <input type="number" id="edit-amount" name="edit-amount" step="0.01" min="0.01" 
                                class="w-full pl-8 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all"
                                required>
                        </div>
                    </div>
                    
                    <div>
                        <label for="edit-category" class="block text-sm font-medium text-gray-700 mb-1">
                            ÂàÜÁ±ª <span class="text-red-500">*</span>
                        </label>
                        <select id="edit-category" name="edit-category" 
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all"
                            required>
                            <!-- ÂàÜÁ±ªÈÄâÈ°πÂ∞ÜÈÄöËøáJSÂä®ÊÄÅÊ∑ªÂä† -->
                        </select>
                    </div>
                </div>
                
                <div>
                    <label for="edit-description" class="block text-sm font-medium text-gray-700 mb-1">
                        Â§áÊ≥®
                    </label>
                    <input type="text" id="edit-description" name="edit-description" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all">
                </div>
                
                <div>
                    <label for="edit-date" class="block text-sm font-medium text-gray-700 mb-1">
                        Êó•Êúü <span class="text-red-500">*</span>
                    </label>
                    <input type="date" id="edit-date" name="edit-date" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all"
                        required>
                </div>
                
                <div class="flex justify-end space-x-3">
                    <button type="button" id="cancel-edit" class="border border-gray-300 px-4 py-2 rounded-lg transition-colors">
                        ÂèñÊ∂à
                    </button>
                    <button type="submit" class="bg-primary hover:bg-primary/90 text-white px-4 py-2 rounded-lg transition-colors">
                        ‰øùÂ≠ò‰øÆÊîπ
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Á°ÆËÆ§Âà†Èô§Ê®°ÊÄÅÊ°Ü -->
    <div id="delete-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl p-6 w-full max-w-md mx-4 cat-shadow">
            <h3 class="text-xl font-bold mb-2 flex items-center">
                <i class="fa fa-exclamation-triangle text-yellow-500 mr-2"></i> Á°ÆËÆ§Âà†Èô§
            </h3>
            <p class="mb-4">‰Ω†Á°ÆÂÆöË¶ÅÂà†Èô§ËøôÊù°ËÆ∞ÂΩïÂêóÔºüÊ≠§Êìç‰ΩúÊó†Ê≥ïÊí§ÈîÄ„ÄÇ</p>
            <input type="hidden" id="delete-id">
            <div class="flex justify-end space-x-3">
                <button id="cancel-delete" class="border border-gray-300 px-4 py-2 rounded-lg transition-colors">
                    ÂèñÊ∂à
                </button>
                <button id="confirm-delete" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors">
                    Âà†Èô§
                </button>
            </div>
        </div>
    </div>

    <!-- ÊàêÂäüÊèêÁ§∫ -->
    <div id="toast" class="fixed bottom-6 right-6 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg transform translate-y-20 opacity-0 transition-all duration-300 flex items-center">
        <i class="fa fa-check-circle mr-2"></i>
        <span id="toast-message"></span>
    </div>

    <!-- Áå´Âí™Ë£ÖÈ•∞ÂÖÉÁ¥† -->
    <div class="fixed top-20 left-4 opacity-20 hidden md:block rotate-cat">
        <i class="fa fa-cat text-6xl text-primary"></i>
    </div>
    <div class="fixed bottom-20 right-4 opacity-20 hidden md:block rotate-cat-reverse">
        <i class="fa fa-paw text-6xl text-primary"></i>
    </div>

    <script>
        // Áî®Êà∑ËÆ§ËØÅÊ®°Âùó
        const AuthService = {
            // ÂàùÂßãÂåñÁî®Êà∑Êï∞ÊçÆ
            init() {
                if (!localStorage.getItem('users')) {
                    localStorage.setItem('users', JSON.stringify([]));
                }
            },
            
            // Ê£ÄÊü•Áî®Êà∑ÂêçÊòØÂê¶Â∑≤Â≠òÂú®
            isUsernameExists(username) {
                const users = JSON.parse(localStorage.getItem('users') || '[]');
                return users.some(user => user.username === username);
            },
            
            // Ê≥®ÂÜåÊñ∞Áî®Êà∑
            register(username, password) {
                const users = JSON.parse(localStorage.getItem('users') || '[]');
                
                // Ê£ÄÊü•Áî®Êà∑ÂêçÊòØÂê¶Â∑≤Â≠òÂú®
                if (this.isUsernameExists(username)) {
                    return { success: false, message: 'Áî®Êà∑ÂêçÂ∑≤Â≠òÂú®' };
                }
                
                // ÂàõÂª∫Êñ∞Áî®Êà∑
                const newUser = {
                    id: Date.now(), // ‰ΩøÁî®Êó∂Èó¥Êà≥‰Ωú‰∏∫ÁÆÄÂçïÁöÑÂîØ‰∏ÄID
                    username,
                    password, // Ê≥®ÊÑèÔºöÂÆûÈôÖÂ∫îÁî®‰∏≠Â∫îËØ•Âä†ÂØÜÂ≠òÂÇ®ÂØÜÁ†Å
                    createdAt: new Date().toISOString()
                };
                
                users.push(newUser);
                localStorage.setItem('users', JSON.stringify(users));
                return { success: true, message: 'Ê≥®ÂÜåÊàêÂäü' };
            },
            
            // Áî®Êà∑ÁôªÂΩï
            login(username, password) {
                const users = JSON.parse(localStorage.getItem('users') || '[]');
                const user = users.find(u => u.username === username && u.password === password);
                
                if (user) {
                    // ‰øùÂ≠òÁôªÂΩïÁä∂ÊÄÅ
                    localStorage.setItem('currentUser', JSON.stringify({
                        id: user.id,
                        username: user.username
                    }));
                    return { success: true, message: 'ÁôªÂΩïÊàêÂäü' };
                }
                
                return { success: false, message: 'Áî®Êà∑ÂêçÊàñÂØÜÁ†ÅÈîôËØØ' };
            },
            
            // Áî®Êà∑ÁôªÂá∫
            logout() {
                localStorage.removeItem('currentUser');
            },
            
            // Ëé∑ÂèñÂΩìÂâçÁôªÂΩïÁî®Êà∑
            getCurrentUser() {
                const user = localStorage.getItem('currentUser');
                return user ? JSON.parse(user) : null;
            },
            
            // Ê£ÄÊü•Áî®Êà∑ÊòØÂê¶Â∑≤ÁôªÂΩï
            isLoggedIn() {
                return !!this.getCurrentUser();
            }
        };

        // Êï∞ÊçÆÊ®°Âûã
        const DataModel = {
            // ÂàùÂßãÂåñÊï∞ÊçÆ
            init() {
                AuthService.init();
                
                // Ê£ÄÊü•Êú¨Âú∞Â≠òÂÇ®‰∏≠ÊòØÂê¶ÊúâÊï∞ÊçÆÔºåÊ≤°ÊúâÂàôÂàùÂßãÂåñ
                if (!localStorage.getItem('expenseCategories')) {
                    const defaultCategories = [
                        { id: 1, name: 'È§êÈ•Æ', icon: 'fa-utensils' },
                        { id: 2, name: 'Ë¥≠Áâ©', icon: 'fa-shopping-bag' },
                        { id: 3, name: '‰ΩèÊàø', icon: 'fa-home' },
                        { id: 4, name: '‰∫§ÈÄö', icon: 'fa-car' },
                        { id: 5, name: 'Áå´Âí™Áî®ÂìÅ', icon: 'fa-paw' }
                    ];
                    localStorage.setItem('expenseCategories', JSON.stringify(defaultCategories));
                }
                
                if (!localStorage.getItem('expenseRecords')) {
                    localStorage.setItem('expenseRecords', JSON.stringify([]));
                }
            },
            
            // Ëé∑ÂèñÊâÄÊúâÂàÜÁ±ªÔºàÂàÜÁ±ªÊòØÂÖ±‰∫´ÁöÑÔºâ
            getCategories() {
                return JSON.parse(localStorage.getItem('expenseCategories') || '[]');
            },
            
            // Ê∑ªÂä†Êñ∞ÂàÜÁ±ª
            addCategory(category) {
                const categories = this.getCategories();
                const newId = categories.length > 0 
                    ? Math.max(...categories.map(c => c.id)) + 1 
                    : 1;
                const newCategory = { id: newId, ...category };
                categories.push(newCategory);
                localStorage.setItem('expenseCategories', JSON.stringify(categories));
                return newCategory;
            },
            
            // Âà†Èô§ÂàÜÁ±ª
            deleteCategory(id) {
                const categories = this.getCategories();
                const updatedCategories = categories.filter(c => c.id !== id);
                localStorage.setItem('expenseCategories', JSON.stringify(updatedCategories));
                
                // ÂêåÊó∂Âà†Èô§ËØ•ÂàÜÁ±ª‰∏ãÁöÑÊâÄÊúâËÆ∞ÂΩïÔºàÊâÄÊúâÁî®Êà∑ÁöÑÔºâ
                const records = this.getRecords();
                const updatedRecords = records.filter(r => r.categoryId !== id);
                localStorage.setItem('expenseRecords', JSON.stringify(updatedRecords));
            },
            
            // Ëé∑ÂèñÂΩìÂâçÁî®Êà∑ÁöÑÊâÄÊúâËÆ∞ÂΩï
            getRecords() {
                const currentUser = AuthService.getCurrentUser();
                if (!currentUser) return [];
                
                const allRecords = JSON.parse(localStorage.getItem('expenseRecords') || '[]');
                // Âè™ËøîÂõûÂΩìÂâçÁî®Êà∑ÁöÑËÆ∞ÂΩï
                return allRecords.filter(record => record.userId === currentUser.id);
            },
            
            // Ê∑ªÂä†Êñ∞ËÆ∞ÂΩïÔºàÂÖ≥ËÅîÂà∞ÂΩìÂâçÁî®Êà∑Ôºâ
            addRecord(record) {
                const currentUser = AuthService.getCurrentUser();
                if (!currentUser) return null;
                
                const allRecords = JSON.parse(localStorage.getItem('expenseRecords') || '[]');
                const newId = allRecords.length > 0 
                    ? Math.max(...allRecords.map(r => r.id)) + 1 
                    : 1;
                // Ê∑ªÂä†Áî®Êà∑IDÔºåÂÖ≥ËÅîÂà∞ÂΩìÂâçÁî®Êà∑
                const newRecord = { id: newId, userId: currentUser.id, ...record };
                allRecords.push(newRecord);
                localStorage.setItem('expenseRecords', JSON.stringify(allRecords));
                return newRecord;
            },
            
            // Êõ¥Êñ∞ËÆ∞ÂΩï
            updateRecord(id, updatedData) {
                const currentUser = AuthService.getCurrentUser();
                if (!currentUser) return null;
                
                const allRecords = JSON.parse(localStorage.getItem('expenseRecords') || '[]');
                const index = allRecords.findIndex(r => r.id === id && r.userId === currentUser.id);
                
                if (index !== -1) {
                    allRecords[index] = { ...allRecords[index], ...updatedData };
                    localStorage.setItem('expenseRecords', JSON.stringify(allRecords));
                    return allRecords[index];
                }
                return null;
            },
            
            // Âà†Èô§ËÆ∞ÂΩï
            deleteRecord(id) {
                const currentUser = AuthService.getCurrentUser();
                if (!currentUser) return;
                
                const allRecords = JSON.parse(localStorage.getItem('expenseRecords') || '[]');
                const updatedRecords = allRecords.filter(r => !(r.id === id && r.userId === currentUser.id));
                localStorage.setItem('expenseRecords', JSON.stringify(updatedRecords));
            },
            
            // ÊåâÊù°‰ª∂Á≠õÈÄâÂΩìÂâçÁî®Êà∑ÁöÑËÆ∞ÂΩï
            filterRecords(filters = {}) {
                const currentUser = AuthService.getCurrentUser();
                if (!currentUser) return [];
                
                let allRecords = JSON.parse(localStorage.getItem('expenseRecords') || '[]');
                // ÂÖàÁ≠õÈÄâÂá∫ÂΩìÂâçÁî®Êà∑ÁöÑËÆ∞ÂΩï
                let records = allRecords.filter(r => r.userId === currentUser.id);
                
                // ÊåâÂπ¥‰ªΩÁ≠õÈÄâ
                if (filters.year) {
                    records = records.filter(r => new Date(r.date).getFullYear() === filters.year);
                }
                
                // ÊåâÊúàÁ≠õÈÄâ
                if (filters.month) {
                    records = records.filter(r => new Date(r.date).getMonth() + 1 === filters.month);
                }
                
                // ÊåâÂàÜÁ±ªÁ≠õÈÄâ
                if (filters.categoryId) {
                    records = records.filter(r => r.categoryId === filters.categoryId);
                }
                
                // ÊåâÊó•ÊúüËåÉÂõ¥Á≠õÈÄâÔºà‰ªäÂ§©„ÄÅÊú¨Âë®„ÄÅÊú¨ÊúàÔºâ
                if (filters.period) {
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);
                    
                    switch (filters.period) {
                        case 'today':
                            records = records.filter(r => new Date(r.date).toDateString() === today.toDateString());
                            break;
                        case 'week':
                            const weekStart = new Date(today);
                            weekStart.setDate(today.getDate() - today.getDay());
                            records = records.filter(r => new Date(r.date) >= weekStart && new Date(r.date) <= new Date());
                            break;
                        case 'month':
                            const monthStart = new Date(today.getFullYear(), today.getMonth(), 1);
                            records = records.filter(r => new Date(r.date) >= monthStart && new Date(r.date) <= new Date());
                            break;
                    }
                }
                
                // ÊåâÊêúÁ¥¢ËØçÁ≠õÈÄâ
                if (filters.search) {
                    const searchLower = filters.search.toLowerCase();
                    records = records.filter(r => 
                        r.description.toLowerCase().includes(searchLower) || 
                        r.amount.toString().includes(searchLower)
                    );
                }
                
                // ÊåâÊó•ÊúüÈôçÂ∫èÊéíÂ∫è
                return records.sort((a, b) => new Date(b.date) - new Date(a.date));
            },
            
            // Ëé∑ÂèñÂàÜÁ±ªÁªüËÆ°Êï∞ÊçÆ
            getCategoryStats(filters = {}) {
                const records = this.filterRecords(filters);
                const categories = this.getCategories();
                
                // ËÆ°ÁÆóÊØè‰∏™ÂàÜÁ±ªÁöÑÊÄªÈáëÈ¢ùÂíåËÆ∞ÂΩïÊï∞
                const stats = categories.map(category => {
                    const categoryRecords = records.filter(r => r.categoryId === category.id);
                    const total = categoryRecords.reduce((sum, r) => sum + parseFloat(r.amount), 0);
                    return {
                        category,
                        total,
                        count: categoryRecords.length
                    };
                }).filter(stat => stat.count > 0 || !filters.categoryId); // ‰øùÁïôÊúâËÆ∞ÂΩïÁöÑÂàÜÁ±ªÊàñÊâÄÊúâÂàÜÁ±ªÔºàÂΩìÊ≤°ÊúâÁ≠õÈÄâÁâπÂÆöÂàÜÁ±ªÊó∂Ôºâ
                
                // ËÆ°ÁÆóÊÄªËÆ°ÂíåÁôæÂàÜÊØî
                const total = stats.reduce((sum, s) => sum + s.total, 0);
                stats.forEach(stat => {
                    stat.percentage = total > 0 ? (stat.total / total) * 100 : 0;
                });
                
                // ÊåâÈáëÈ¢ùÈôçÂ∫èÊéíÂ∫è
                return {
                    stats: stats.sort((a, b) => b.total - a.total),
                    total
                };
            },
            
            // Ëé∑ÂèñË∂ãÂäøÁªüËÆ°Êï∞ÊçÆ
            getTrendStats(filters = {}) {
                const records = this.filterRecords(filters);
                const isMonthly = filters.periodType === 'month';
                
                // ÊåâÊó•ÊàñÊåâÊúàÂàÜÁªÑ
                const groups = {};
                
                records.forEach(record => {
                    const date = new Date(record.date);
                    let key;
                    
                    if (isMonthly) {
                        // ÊåâÊúàËßÜÂõæÔºöÊåâÊó•ÂàÜÁªÑ
                        key = date.getDate();
                    } else {
                        // ÊåâÂπ¥ËßÜÂõæÔºöÊåâÊúàÂàÜÁªÑ
                        key = date.getMonth() + 1;
                    }
                    
                    if (!groups[key]) {
                        groups[key] = 0;
                    }
                    groups[key] += parseFloat(record.amount);
                });
                
                // ÂáÜÂ§áÂõæË°®Êï∞ÊçÆ
                const labels = isMonthly 
                    ? Array.from({length: new Date(filters.year, filters.month, 0).getDate()}, (_, i) => i + 1)
                    : Array.from({length: 12}, (_, i) => i + 1);
                
                const data = labels.map(key => groups[key] || 0);
                
                return {
                    labels,
                    data
                };
            }
        };

        // UIÊéßÂà∂Âô®
        const UIController = {
            // ÂàùÂßãÂåñUI
            init() {
                // Ê£ÄÊü•Áî®Êà∑ÊòØÂê¶Â∑≤ÁôªÂΩï
                if (AuthService.isLoggedIn()) {
                    this.showApp();
                    this.updateUserDisplay();
                } else {
                    // ÊòæÁ§∫ÁôªÂΩïÊ®°ÊÄÅÊ°Ü
                    document.getElementById('login-modal').classList.remove('hidden');
                }
                
                this.setCurrentDate();
                this.initDateField();
                this.renderCategories();
                this.renderHistory();
                this.renderStatistics();
                this.updateSummaryStats();
                this.initEventListeners();
                this.populateYearSelector();
            },
            
            // ÊòæÁ§∫Â∫îÁî®ÂÜÖÂÆπÔºàÁî®Êà∑Â∑≤ÁôªÂΩïÔºâ
            showApp() {
                document.getElementById('login-modal').classList.add('hidden');
                // ÂèØ‰ª•Âú®ËøôÈáåÊ∑ªÂä†Â∫îÁî®ÂÜÖÂÆπÁöÑÊòæÁ§∫ÈÄªËæë
            },
            
            // Êõ¥Êñ∞Áî®Êà∑ÊòæÁ§∫
            updateUserDisplay() {
                const user = AuthService.getCurrentUser();
                if (user) {
                    document.getElementById('user-display').textContent = `Ê¨¢ËøéÔºå${user.username}`;
                    document.getElementById('mobile-user-display').textContent = user.username;
                    document.getElementById('welcome-username').textContent = user.username;
                    document.getElementById('logout-btn').classList.remove('hidden');
                }
            },
            
            // ËÆæÁΩÆÂΩìÂâçÊó•ÊúüÊòæÁ§∫
            setCurrentDate() {
                const now = new Date();
                const options = { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' };
                document.getElementById('current-date').textContent = now.toLocaleDateString('zh-CN', options);
            },
            
            // ÂàùÂßãÂåñÊó•ÊúüÂ≠óÊÆµ‰∏∫ÂΩìÂâçÊó•Êúü
            initDateField() {
                const now = new Date();
                const dateString = now.toISOString().split('T')[0];
                document.getElementById('date').value = dateString;
                
                // ËÆæÁΩÆÁªüËÆ°ÈªòËÆ§Âπ¥‰ªΩÂíåÊúà‰ªΩ‰∏∫ÂΩìÂâç
                document.getElementById('stats-year').value = now.getFullYear();
                document.getElementById('stats-month').value = now.getMonth() + 1;
            },
            
            // Ê∏≤ÊüìÂàÜÁ±ªÂàóË°®
            renderCategories() {
                const categories = DataModel.getCategories();
                const container = document.getElementById('categories-container');
                const categorySelect = document.getElementById('category');
                const editCategorySelect = document.getElementById('edit-category');
                const filterSelect = document.getElementById('category-filter');
                
                // Ê∏ÖÁ©∫Áé∞ÊúâÂÜÖÂÆπ
                container.innerHTML = '';
                categorySelect.innerHTML = '<option value="">ËØ∑ÈÄâÊã©ÂàÜÁ±ª</option>';
                editCategorySelect.innerHTML = '';
                filterSelect.innerHTML = '<option value="">ÊâÄÊúâÂàÜÁ±ª</option>';
                
                // Ê∑ªÂä†ÂàÜÁ±ªÂà∞UI
                categories.forEach(category => {
                    // ÂàÜÁ±ªÂç°Áâá
                    const card = document.createElement('div');
                    card.className = 'bg-gray-50 rounded-lg p-4 flex justify-between items-center cat-border hover:bg-primary/5 transition-colors';
                    card.innerHTML = `
                        <div class="flex items-center">
                            <div class="w-10 h-10 bg-primary/20 rounded-full flex items-center justify-center mr-3">
                                <i class="fa ${category.icon} text-primary"></i>
                            </div>
                            <span class="font-medium">${category.name}</span>
                        </div>
                        <button class="delete-category text-gray-400 hover:text-red-500 transition-colors" data-id="${category.id}">
                            <i class="fa fa-trash"></i>
                        </button>
                    `;
                    container.appendChild(card);
                    
                    // Ê∑ªÂä†Âà∞ÂàÜÁ±ªÈÄâÊã©Âô®
                    const option = document.createElement('option');
                    option.value = category.id;
                    option.textContent = category.name;
                    categorySelect.appendChild(option);
                    
                    // Ê∑ªÂä†Âà∞ÁºñËæëÂàÜÁ±ªÈÄâÊã©Âô®
                    const editOption = document.createElement('option');
                    editOption.value = category.id;
                    editOption.textContent = category.name;
                    editCategorySelect.appendChild(editOption);
                    
                    // Ê∑ªÂä†Âà∞Á≠õÈÄâÂô®
                    const filterOption = document.createElement('option');
                    filterOption.value = category.id;
                    filterOption.textContent = category.name;
                    filterSelect.appendChild(filterOption);
                });
            },
            
            // Ê∏≤ÊüìÂéÜÂè≤ËÆ∞ÂΩï
            renderHistory(filters = {}) {
                const records = DataModel.filterRecords(filters);
                const container = document.getElementById('history-list');
                const categories = DataModel.getCategories();
                
                // Ê∏ÖÁ©∫Áé∞ÊúâÂÜÖÂÆπ
                container.innerHTML = '';
                
                if (records.length === 0) {
                    container.innerHTML = `
                        <tr class="text-center">
                            <td colspan="5" class="px-4 py-8 text-gray-500">
                                <div class="flex flex-col items-center">
                                    <i class="fa fa-cat text-4xl text-gray-300 mb-2"></i>
                                    <p>ËøòÊ≤°ÊúâËÆ∞ÂΩïÂì¶ÔºåÊ∑ªÂä†‰Ω†ÁöÑÁ¨¨‰∏ÄÁ¨îÊîØÂá∫ÂêßÔºÅ</p>
                                </div>
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                // Ê∑ªÂä†ËÆ∞ÂΩïÂà∞Ë°®Ê†º
                records.forEach(record => {
                    const category = categories.find(c => c.id === record.categoryId);
                    const row = document.createElement('tr');
                    row.className = 'hover:bg-gray-50 transition-colors';
                    row.innerHTML = `
                        <td class="px-4 py-3 whitespace-nowrap">
                            ${new Date(record.date).toLocaleDateString('zh-CN')}
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap">
                            <div class="flex items-center">
                                <i class="fa ${category?.icon || 'fa-question'} text-primary mr-2"></i>
                                ${category?.name || 'Êú™Áü•ÂàÜÁ±ª'}
                            </div>
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap font-medium">
                            ¬•${parseFloat(record.amount).toFixed(2)}
                        </td>
                        <td class="px-4 py-3">
                            ${record.description || '-'}
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap">
                            <div class="flex space-x-2">
                                <button class="edit-record text-blue-500 hover:text-blue-700 transition-colors" data-id="${record.id}">
                                    <i class="fa fa-edit"></i>
                                </button>
                                <button class="delete-record text-red-500 hover:text-red-700 transition-colors" data-id="${record.id}">
                                    <i class="fa fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    container.appendChild(row);
                });
                
                // ÁªëÂÆöÁºñËæëÂíåÂà†Èô§ÊåâÈíÆ‰∫ã‰ª∂
                this.bindRecordActions();
            },
            
            // Ê∏≤ÊüìÁªüËÆ°ÂõæË°®
            renderStatistics() {
                const year = parseInt(document.getElementById('stats-year').value);
                const month = parseInt(document.getElementById('stats-month').value);
                const categoryId = document.getElementById('category-filter').value 
                    ? parseInt(document.getElementById('category-filter').value) 
                    : null;
                const isMonthly = document.querySelector('.period-btn.bg-primary').dataset.period === 'month';
                
                // Á≠õÈÄâÊù°‰ª∂
                const filters = {
                    year,
                    categoryId,
                    periodType: isMonthly ? 'month' : 'year'
                };
                
                if (isMonthly) {
                    filters.month = month;
                }
                
                // Ëé∑ÂèñÁªüËÆ°Êï∞ÊçÆ
                const categoryStats = DataModel.getCategoryStats(filters);
                const trendStats = DataModel.getTrendStats(filters);
                
                // Ê∏≤ÊüìÂàÜÁ±ªÁªüËÆ°Ë°®Ê†º
                this.renderCategoryStatsTable(categoryStats.stats);
                
                // Ê∏≤ÊüìÊîØÂá∫ÂàÜÂ∏ÉÂõæË°®
                this.renderExpenseChart(categoryStats.stats);
                
                // Ê∏≤ÊüìË∂ãÂäøÂõæË°®
                this.renderTrendChart(trendStats, isMonthly);
            },
            
            // Ê∏≤ÊüìÂàÜÁ±ªÁªüËÆ°Ë°®Ê†º
            renderCategoryStatsTable(stats) {
                const container = document.getElementById('category-stats-body');
                container.innerHTML = '';
                
                if (stats.length === 0) {
                    container.innerHTML = `
                        <tr class="text-center">
                            <td colspan="4" class="px-4 py-6 text-gray-500">
                                Ê≤°ÊúâÊâæÂà∞ÁªüËÆ°Êï∞ÊçÆ
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                stats.forEach(stat => {
                    const row = document.createElement('tr');
                    row.className = 'hover:bg-gray-50 transition-colors';
                    row.innerHTML = `
                        <td class="px-4 py-3 whitespace-nowrap">
                            <div class="flex items-center">
                                <i class="fa ${stat.category.icon} text-primary mr-2"></i>
                                ${stat.category.name}
                            </div>
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap font-medium">
                            ¬•${stat.total.toFixed(2)}
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap">
                            <div class="flex items-center">
                                <div class="w-24 bg-gray-200 rounded-full h-2 mr-2">
                                    <div class="bg-primary h-2 rounded-full" style="width: ${stat.percentage}%"></div>
                                </div>
                                <span>${stat.percentage.toFixed(1)}%</span>
                            </div>
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap">
                            ${stat.count}
                        </td>
                    `;
                    container.appendChild(row);
                });
            },
            
            // Ê∏≤ÊüìÊîØÂá∫ÂàÜÂ∏ÉÂõæË°®
            renderExpenseChart(stats) {
                const ctx = document.getElementById('expense-chart').getContext('2d');
                
                // ÂáÜÂ§áÂõæË°®Êï∞ÊçÆ
                const labels = stats.map(stat => stat.category.name);
                const data = stats.map(stat => stat.total);
                const backgroundColors = [
                    '#FF9AA2', '#B5EAD7', '#C7CEEA', '#FFDAC1', '#E2F0CB', 
                    '#FD9A9A', '#FECB65', '#A1C4FD', '#C8E6C9', '#FFB7B2'
                ];
                
                // Â¶ÇÊûúÂ∑≤ÊúâÂõæË°®ÂÆû‰æãÔºåÂÖàÈîÄÊØÅ
                if (window.expenseChartInstance) {
                    window.expenseChartInstance.destroy();
                }
                
                // ÂàõÂª∫Êñ∞ÂõæË°®
                window.expenseChartInstance = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: labels,
                        datasets: [{
                            data: data,
                            backgroundColor: backgroundColors.slice(0, labels.length),
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'right',
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const value = context.raw;
                                        const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                        const percentage = ((value / total) * 100).toFixed(1);
                                        return `${context.label}: ¬•${value.toFixed(2)} (${percentage}%)`;
                                    }
                                }
                            }
                        }
                    }
                });
            },
            
            // Ê∏≤ÊüìË∂ãÂäøÂõæË°®
            renderTrendChart(trendStats, isMonthly) {
                const ctx = document.getElementById('trend-chart').getContext('2d');
                
                // ÂáÜÂ§áÂõæË°®Êï∞ÊçÆ
                const labels = isMonthly 
                    ? trendStats.labels.map(day => `${day}Êó•`)
                    : trendStats.labels.map(month => `${month}Êúà`);
                
                // Â¶ÇÊûúÂ∑≤ÊúâÂõæË°®ÂÆû‰æãÔºåÂÖàÈîÄÊØÅ
                if (window.trendChartInstance) {
                    window.trendChartInstance.destroy();
                }
                
                // ÂàõÂª∫Êñ∞ÂõæË°®
                window.trendChartInstance = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'ÊîØÂá∫ÈáëÈ¢ù',
                            data: trendStats.data,
                            backgroundColor: '#FF9AA2',
                            borderColor: '#FF9AA2',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return '¬•' + value;
                                    }
                                }
                            }
                        },
                        plugins: {
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `ÈáëÈ¢ù: ¬•${context.raw.toFixed(2)}`;
                                    }
                                }
                            }
                        }
                    }
                });
            },
            
            // Êõ¥Êñ∞ÊëòË¶ÅÁªüËÆ°‰ø°ÊÅØ
            updateSummaryStats() {
                const now = new Date();
                const currentYear = now.getFullYear();
                const currentMonth = now.getMonth() + 1;
                
                // Êú¨ÊúàÁªüËÆ°
                const monthlyStats = DataModel.getCategoryStats({
                    year: currentYear,
                    month: currentMonth
                });
                
                // ‰∏äÊúàÁªüËÆ°ÔºàÁî®‰∫éËÆ°ÁÆóÂèòÂåñÁéáÔºâ
                let lastMonth = currentMonth - 1;
                let lastYear = currentYear;
                if (lastMonth < 1) {
                    lastMonth = 12;
                    lastYear = currentYear - 1;
                }
                
                const lastMonthStats = DataModel.getCategoryStats({
                    year: lastYear,
                    month: lastMonth
                });
                
                // Êõ¥Êñ∞UI
                document.getElementById('monthly-total').textContent = `¬•${monthlyStats.total.toFixed(2)}`;
                document.getElementById('record-count').textContent = DataModel.filterRecords({
                    year: currentYear,
                    month: currentMonth
                }).length;
                
                // ËÆ°ÁÆóÂπ∂Êõ¥Êñ∞ÂèòÂåñÁéá
                if (lastMonthStats.total > 0) {
                    const changeRate = ((monthlyStats.total - lastMonthStats.total) / lastMonthStats.total) * 100;
                    const changeText = changeRate >= 0 
                        ? `+${changeRate.toFixed(1)}%` 
                        : `${changeRate.toFixed(1)}%`;
                    const changeClass = changeRate >= 0 ? 'text-red-500' : 'text-green-500';
                    const changeIcon = changeRate >= 0 ? 'fa-arrow-up' : 'fa-arrow-down';
                    
                    document.getElementById('monthly-change').innerHTML = `
                        <span class="${changeClass}">
                            <i class="fa ${changeIcon}"></i> ${changeText}
                        </span>
                    `;
                } else {
                    document.getElementById('monthly-change').textContent = '0%';
                }
                
                // Êõ¥Êñ∞ÊúÄÂ§ßÊîØÂá∫ÂàÜÁ±ª
                if (monthlyStats.stats.length > 0) {
                    document.getElementById('top-category').textContent = monthlyStats.stats[0].category.name;
                } else {
                    document.getElementById('top-category').textContent = 'ÊöÇÊó†Êï∞ÊçÆ';
                }
            },
            
            // Â°´ÂÖÖÂπ¥‰ªΩÈÄâÊã©Âô®
            populateYearSelector() {
                const yearSelect = document.getElementById('stats-year');
                const currentUser = AuthService.getCurrentUser();
                if (!currentUser) return;
                
                const allRecords = JSON.parse(localStorage.getItem('expenseRecords') || '[]');
                const userRecords = allRecords.filter(r => r.userId === currentUser.id);
                
                // Ëé∑ÂèñÊâÄÊúâËÆ∞ÂΩï‰∏≠ÁöÑÂπ¥‰ªΩ
                const years = new Set();
                const currentYear = new Date().getFullYear();
                years.add(currentYear);
                years.add(currentYear - 1);
                
                userRecords.forEach(record => {
                    const year = new Date(record.date).getFullYear();
                    years.add(year);
                });
                
                // Ê∏ÖÁ©∫Âπ∂Ê∑ªÂä†Âπ¥‰ªΩÈÄâÈ°π
                yearSelect.innerHTML = '';
                Array.from(years).sort((a, b) => b - a).forEach(year => {
                    const option = document.createElement('option');
                    option.value = year;
                    option.textContent = year;
                    yearSelect.appendChild(option);
                });
            },
            
            // ÊòæÁ§∫ÊèêÁ§∫Ê∂àÊÅØ
            showToast(message) {
                const toast = document.getElementById('toast');
                const toastMessage = document.getElementById('toast-message');
                
                toastMessage.textContent = message;
                toast.classList.remove('translate-y-20', 'opacity-0');
                toast.classList.add('translate-y-0', 'opacity-100');
                
                setTimeout(() => {
                    toast.classList.remove('translate-y-0', 'opacity-100');
                    toast.classList.add('translate-y-20', 'opacity-0');
                }, 3000);
            },
            
            // ÁªëÂÆöËÆ∞ÂΩïÊìç‰ΩúÊåâÈíÆ‰∫ã‰ª∂
            bindRecordActions() {
                // ÁºñËæëËÆ∞ÂΩï
                document.querySelectorAll('.edit-record').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const id = parseInt(e.currentTarget.dataset.id);
                        const allRecords = JSON.parse(localStorage.getItem('expenseRecords') || '[]');
                        const currentUser = AuthService.getCurrentUser();
                        const record = allRecords.find(r => r.id === id && r.userId === currentUser.id);
                        
                        if (record) {
                            document.getElementById('edit-id').value = record.id;
                            document.getElementById('edit-amount').value = record.amount;
                            document.getElementById('edit-category').value = record.categoryId;
                            document.getElementById('edit-description').value = record.description || '';
                            document.getElementById('edit-date').value = record.date;
                            
                            document.getElementById('edit-modal').classList.remove('hidden');
                        }
                    });
                });
                
                // Âà†Èô§ËÆ∞ÂΩï
                document.querySelectorAll('.delete-record').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const id = parseInt(e.currentTarget.dataset.id);
                        document.getElementById('delete-id').value = id;
                        document.getElementById('delete-modal').classList.remove('hidden');
                    });
                });
            },
            
            // ÂàùÂßãÂåñÊâÄÊúâ‰∫ã‰ª∂ÁõëÂê¨Âô®
            initEventListeners() {
                // ÁôªÂΩïË°®ÂçïÊèê‰∫§
                document.getElementById('login-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    
                    const username = document.getElementById('login-username').value;
                    const password = document.getElementById('login-password').value;
                    
                    const result = AuthService.login(username, password);
                    if (result.success) {
                        this.showApp();
                        this.updateUserDisplay();
                        this.renderHistory();
                        this.renderStatistics();
                        this.updateSummaryStats();
                        this.populateYearSelector();
                        this.showToast(result.message);
                    } else {
                        alert(result.message);
                    }
                });
                
                // Ê≥®ÂÜåË°®ÂçïÊèê‰∫§
                document.getElementById('register-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    
                    const username = document.getElementById('register-username').value;
                    const password = document.getElementById('register-password').value;
                    const confirm = document.getElementById('register-confirm').value;
                    
                    // Ê£ÄÊü•Áî®Êà∑ÂêçÊòØÂê¶Â∑≤Â≠òÂú®
                    if (AuthService.isUsernameExists(username)) {
                        document.getElementById('username-error').classList.remove('hidden');
                        return;
                    }
                    
                    if (password !== confirm) {
                        alert('‰∏§Ê¨°ËæìÂÖ•ÁöÑÂØÜÁ†Å‰∏ç‰∏ÄËá¥');
                        return;
                    }
                    
                    const result = AuthService.register(username, password);
                    if (result.success) {
                        // Ê≥®ÂÜåÊàêÂäüÂêéËá™Âä®ÁôªÂΩï
                        AuthService.login(username, password);
                        this.showApp();
                        this.updateUserDisplay();
                        this.renderHistory();
                        this.renderStatistics();
                        this.updateSummaryStats();
                        this.populateYearSelector();
                        this.showToast('Ê≥®ÂÜåÂπ∂ÁôªÂΩïÊàêÂäüÔºÅ');
                    } else {
                        alert(result.message);
                    }
                });
                
                // ÂÆûÊó∂Ê£ÄÊü•Áî®Êà∑ÂêçÊòØÂê¶Â∑≤Â≠òÂú®
                document.getElementById('register-username').addEventListener('input', (e) => {
                    const username = e.target.value.trim();
                    const errorElement = document.getElementById('username-error');
                    
                    if (username && AuthService.isUsernameExists(username)) {
                        errorElement.classList.remove('hidden');
                    } else {
                        errorElement.classList.add('hidden');
                    }
                });
                
                // ÂàáÊç¢Âà∞ÁôªÂΩïË°®Âçï
                document.getElementById('show-login').addEventListener('click', () => {
                    this.showLoginForm();
                });
                
                // ÂàáÊç¢Âà∞Ê≥®ÂÜåË°®Âçï
                document.getElementById('show-register').addEventListener('click', () => {
                    this.showRegisterForm();
                });
                
                // ÁôªÂá∫ÊåâÈíÆ
                document.getElementById('logout-btn').addEventListener('click', () => {
                    AuthService.logout();
                    window.location.reload(); // ÈáçÊñ∞Âä†ËΩΩÈ°µÈù¢ÔºåÊòæÁ§∫ÁôªÂΩïÁïåÈù¢
                });
                
                // ÁßªÂä®Á´ØÁôªÂá∫ÊåâÈíÆ
                document.getElementById('mobile-logout-btn').addEventListener('click', () => {
                    AuthService.logout();
                    window.location.reload(); // ÈáçÊñ∞Âä†ËΩΩÈ°µÈù¢ÔºåÊòæÁ§∫ÁôªÂΩïÁïåÈù¢
                });
                
                // ÁßªÂä®Á´ØËèúÂçïÂàáÊç¢
                document.getElementById('mobile-menu-button').addEventListener('click', () => {
                    document.getElementById('mobile-menu').classList.toggle('hidden');
                });
                
                // Ê∑ªÂä†Êñ∞ËÆ∞ÂΩïË°®ÂçïÊèê‰∫§
                document.getElementById('expense-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    
                    const newRecord = {
                        amount: parseFloat(document.getElementById('amount').value),
                        categoryId: parseInt(document.getElementById('category').value),
                        description: document.getElementById('description').value,
                        date: document.getElementById('date').value
                    };
                    
                    DataModel.addRecord(newRecord);
                    this.renderHistory();
                    this.renderStatistics();
                    this.updateSummaryStats();
                    this.populateYearSelector();
                    
                    // ÈáçÁΩÆË°®Âçï
                    e.target.reset();
                    document.getElementById('date').value = new Date().toISOString().split('T')[0];
                    
                    this.showToast('ËÆ∞ÂΩïÊ∑ªÂä†ÊàêÂäüÔºÅ');
                });
                
                // Ê∑ªÂä†ÂàÜÁ±ªÊåâÈíÆ
                document.getElementById('add-category-btn').addEventListener('click', () => {
                    document.getElementById('category-modal').classList.remove('hidden');
                    document.getElementById('new-category-name').value = '';
                    this.resetIconSelection();
                });
                
                // ÂèñÊ∂àÊ∑ªÂä†ÂàÜÁ±ª
                document.getElementById('cancel-category').addEventListener('click', () => {
                    document.getElementById('category-modal').classList.add('hidden');
                });
                
                // ÂõæÊ†áÈÄâÊã©
                document.querySelectorAll('.icon-option').forEach(option => {
                    option.addEventListener('click', (e) => {
                        this.resetIconSelection();
                        e.currentTarget.classList.add('bg-primary/20', 'ring-2', 'ring-primary');
                        document.getElementById('selected-icon').value = e.currentTarget.dataset.icon;
                    });
                });
                
                // Ê∑ªÂä†ÂàÜÁ±ªË°®ÂçïÊèê‰∫§
                document.getElementById('add-category-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    
                    const newCategory = {
                        name: document.getElementById('new-category-name').value,
                        icon: document.getElementById('selected-icon').value
                    };
                    
                    DataModel.addCategory(newCategory);
                    this.renderCategories();
                    document.getElementById('category-modal').classList.add('hidden');
                    this.showToast('ÂàÜÁ±ªÊ∑ªÂä†ÊàêÂäüÔºÅ');
                });
                
                // Âà†Èô§ÂàÜÁ±ª
                document.getElementById('categories-container').addEventListener('click', (e) => {
                    if (e.target.closest('.delete-category')) {
                        const id = parseInt(e.target.closest('.delete-category').dataset.id);
                        if (confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™ÂàÜÁ±ªÂêóÔºüËØ•ÂàÜÁ±ª‰∏ãÁöÑÊâÄÊúâËÆ∞ÂΩï‰πü‰ºöË¢´Âà†Èô§„ÄÇ')) {
                            DataModel.deleteCategory(id);
                            this.renderCategories();
                            this.renderHistory();
                            this.renderStatistics();
                            this.updateSummaryStats();
                            this.showToast('ÂàÜÁ±ªÂ∑≤Âà†Èô§');
                        }
                    }
                });
                
                // ÁªüËÆ°Âë®ÊúüÂàáÊç¢
                document.querySelectorAll('.period-btn').forEach(button => {
                    button.addEventListener('click', (e) => {
                        document.querySelectorAll('.period-btn').forEach(btn => {
                            btn.classList.remove('bg-primary', 'text-white');
                            btn.classList.add('bg-gray-200', 'hover:bg-gray-300');
                        });
                        
                        e.currentTarget.classList.remove('bg-gray-200', 'hover:bg-gray-300');
                        e.currentTarget.classList.add('bg-primary', 'text-white');
                        
                        // ÊòæÁ§∫ÊàñÈöêËóèÊúà‰ªΩÈÄâÊã©Âô®
                        const isMonthly = e.currentTarget.dataset.period === 'month';
                        document.getElementById('month-select-container').classList.toggle('hidden', !isMonthly);
                        
                        this.renderStatistics();
                    });
                });
                
                // ÁªüËÆ°Á≠õÈÄâÂô®ÂèòÂåñ
                document.getElementById('stats-year').addEventListener('change', () => {
                    this.renderStatistics();
                });
                
                document.getElementById('stats-month').addEventListener('change', () => {
                    this.renderStatistics();
                });
                
                document.getElementById('category-filter').addEventListener('change', () => {
                    this.renderStatistics();
                });
                
                // ÂéÜÂè≤ËÆ∞ÂΩïÁ≠õÈÄâ
                document.querySelectorAll('.history-filter-btn').forEach(button => {
                    button.addEventListener('click', (e) => {
                        document.querySelectorAll('.history-filter-btn').forEach(btn => {
                            btn.classList.remove('bg-primary', 'text-white');
                            btn.classList.add('bg-gray-200', 'hover:bg-gray-300');
                        });
                        
                        e.currentTarget.classList.remove('bg-gray-200', 'hover:bg-gray-300');
                        e.currentTarget.classList.add('bg-primary', 'text-white');
                        
                        const filter = e.currentTarget.dataset.filter;
                        this.renderHistory(filter !== 'all' ? { period: filter } : {});
                    });
                });
                
                // ÂéÜÂè≤ËÆ∞ÂΩïÊêúÁ¥¢
                document.getElementById('search-history').addEventListener('input', (e) => {
                    const searchTerm = e.target.value.trim();
                    this.renderHistory(searchTerm ? { search: searchTerm } : {});
                });
                
                // ÂèñÊ∂àÁºñËæë
                document.getElementById('cancel-edit').addEventListener('click', () => {
                    document.getElementById('edit-modal').classList.add('hidden');
                });
                
                // Êèê‰∫§ÁºñËæë
                document.getElementById('edit-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    
                    const id = parseInt(document.getElementById('edit-id').value);
                    const updatedData = {
                        amount: parseFloat(document.getElementById('edit-amount').value),
                        categoryId: parseInt(document.getElementById('edit-category').value),
                        description: document.getElementById('edit-description').value,
                        date: document.getElementById('edit-date').value
                    };
                    
                    DataModel.updateRecord(id, updatedData);
                    this.renderHistory();
                    this.renderStatistics();
                    this.updateSummaryStats();
                    this.populateYearSelector();
                    
                    document.getElementById('edit-modal').classList.add('hidden');
                    this.showToast('ËÆ∞ÂΩïÂ∑≤Êõ¥Êñ∞');
                });
                
                // ÂèñÊ∂àÂà†Èô§
                document.getElementById('cancel-delete').addEventListener('click', () => {
                    document.getElementById('delete-modal').classList.add('hidden');
                });
                
                // Á°ÆËÆ§Âà†Èô§
                document.getElementById('confirm-delete').addEventListener('click', () => {
                    const id = parseInt(document.getElementById('delete-id').value);
                    DataModel.deleteRecord(id);
                    
                    this.renderHistory();
                    this.renderStatistics();
                    this.updateSummaryStats();
                    this.populateYearSelector();
                    
                    document.getElementById('delete-modal').classList.add('hidden');
                    this.showToast('ËÆ∞ÂΩïÂ∑≤Âà†Èô§');
                });
                
                // Âπ≥ÊªëÊªöÂä®
                document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                    anchor.addEventListener('click', function(e) {
                        e.preventDefault();
                        const targetId = this.getAttribute('href');
                        const targetElement = document.querySelector(targetId);
                        
                        if (targetElement) {
                            window.scrollTo({
                                top: targetElement.offsetTop - 80,
                                behavior: 'smooth'
                            });
                            
                            // ÂÖ≥Èó≠ÁßªÂä®ËèúÂçï
                            document.getElementById('mobile-menu').classList.add('hidden');
                        }
                    });
                });
                
                // ÊªöÂä®Êó∂ÊîπÂèòÂØºËà™Ê†èÊ†∑Âºè
                window.addEventListener('scroll', () => {
                    const header = document.querySelector('header');
                    if (window.scrollY > 10) {
                        header.classList.add('py-2');
                        header.classList.remove('py-3');
                    } else {
                        header.classList.add('py-3');
                        header.classList.remove('py-2');
                    }
                });
            },
            
            // ÊòæÁ§∫ÁôªÂΩïË°®Âçï
            showLoginForm() {
                document.getElementById('login-form').classList.remove('hidden');
                document.getElementById('register-form').classList.add('hidden');
                document.getElementById('show-login').classList.add('border-primary', 'text-primary');
                document.getElementById('show-login').classList.remove('border-transparent', 'text-gray-500');
                document.getElementById('show-register').classList.add('border-transparent', 'text-gray-500');
                document.getElementById('show-register').classList.remove('border-primary', 'text-primary');
            },
            
            // ÊòæÁ§∫Ê≥®ÂÜåË°®Âçï
            showRegisterForm() {
                document.getElementById('login-form').classList.add('hidden');
                document.getElementById('register-form').classList.remove('hidden');
                document.getElementById('show-register').classList.add('border-primary', 'text-primary');
                document.getElementById('show-register').classList.remove('border-transparent', 'text-gray-500');
                document.getElementById('show-login').classList.add('border-transparent', 'text-gray-500');
                document.getElementById('show-login').classList.remove('border-primary', 'text-primary');
            },
            
            // ÈáçÁΩÆÂõæÊ†áÈÄâÊã©Áä∂ÊÄÅ
            resetIconSelection() {
                document.querySelectorAll('.icon-option').forEach(option => {
                    option.classList.remove('bg-primary/20', 'ring-2', 'ring-primary');
                });
                // ÈªòËÆ§ÈÄâ‰∏≠Á¨¨‰∏Ä‰∏™ÂõæÊ†á
                const firstIcon = document.querySelector('.icon-option');
                if (firstIcon) {
                    firstIcon.classList.add('bg-primary/20', 'ring-2', 'ring-primary');
                    document.getElementById('selected-icon').value = firstIcon.dataset.icon;
                }
            }
        };

        // ÂàùÂßãÂåñÂ∫îÁî®
        document.addEventListener('DOMContentLoaded', () => {
            DataModel.init();
            UIController.init();
        });
    </script>
</body>
</html>
